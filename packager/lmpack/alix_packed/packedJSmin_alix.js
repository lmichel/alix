/*
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
 LICENSE

 Copyright (c) 2017 Laurent Michel

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
 ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 IN THE SOFTWARE. 
*/
function Segment(a){function b(a,b,c){var d;d=parseInt(b);d=Math.abs(a.xA-d);d=1>=d&&0<=d?d:-1;if(-1!=d)return{flag:"vertical",segmento:a};var f;f=parseInt(c);f=Math.abs(a.yA-f);f=1>=f&&0<=f?f:-1;return-1!=f?{flag:"horizontal",segmento:a}:-1==d&&-1==f&&(d=h=-((a.yB-a.yA)/(a.xB-a.xA)),f=e=-(h*a.xA)-a.yA,b=Math.abs(d*parseInt(b)+parseInt(c)+f),b/=Math.sqrt(d*d+1),2>=b&&0<=b)?{flag:"distancia",segmento:a,alfa:d,beta:f}:-1}function c(a){var b=[],c,d,e;for(e in a)void 0==c?c=e:void 0==d&&(d=e),void 0!=
c&&void 0!=d&&(b.push({A:c,B:d}),c=d,d=void 0),parseInt(l.length-1)==e&&b.push({A:l.length-1,B:0});return b}function d(a,b,c,d,e,f,h,l){a=(a-c)*(f-l)-(b-d)*(e-h);return 0==a?-1:a}function f(a,b,c,d,e,f,h,l,m,s){return s<Math.min(b,d)||s>Math.max(b,d)||s<Math.min(f,l)||s>Math.max(f,l)||m<Math.min(a,c)||m>Math.max(a,c)||m<Math.min(e,h)||m>Math.max(e,h)?-1:2}var h,e,l=[],l=a,m;this.IsCursorOn=function(a,d){var e;m=c(l);a:{e=parseInt(a);var f=parseInt(d),h,k,n,r,p;for(p in m){var s,q,t,g;h=l[m[p].A].cx;
n=l[m[p].A].cy;k=l[m[p].B].cx;r=l[m[p].B].cy;s=parseInt(h)>parseInt(k)?k:h;q=parseInt(h)>parseInt(k)?h:k;t=parseInt(n)>parseInt(r)?r:n;g=parseInt(n)>parseInt(r)?n:r;if(e>=s&&e<=q&&f>=t&&f<=g&&(seg={xA:h,yA:n,xB:k,yB:r,segmento:p},-1!=(dis=b(seg,e,f)))){e={xA:h,yA:n,xB:k,yB:r,segmento:p};break a}if(q===s&&f>=t&&f<=g&&(seg={xA:h,yA:n,xB:k,yB:r,segmento:p},-1!=(dis=b(seg,e,f)))){e={xA:h,yA:n,xB:k,yB:r,segmento:p};break a}if(t===g&&e>s&&e<q&&(seg={xA:h,yA:n,xB:k,yB:r,segmento:p},-1!=(dis=b(seg,e,f)))){e=
{xA:h,yA:n,xB:k,yB:r,segmento:p};break a}}e=void 0}if(seg=e)return e=b(seg,a,d)};this.Itersection=function(a,b){var e=c(l),h=e.length-2,m,k;k=-1;var n,r,p,s,q,t,g,u;a=parseInt(a);if(!1===b){if(3<e.length)if(0!=a){n=l[e[h].A].cx;q=l[e[h].A].cy;p=l[e[h].B].cx;g=l[e[h].B].cy;var C=parseInt(e[h].A),D=parseInt(e[h].B),y;for(y in e)if(r=l[e[y].A].cx,t=l[e[y].A].cy,s=l[e[y].B].cx,u=l[e[y].B].cy,k=d(n,q,p,g,r,t,s,u),-1!=k&&(m=((r-s)*(n*g-q*p)-(n-p)*(r*u-t*s))/k,k=((t-u)*(n*g-q*p)-(q-g)*(r*u-t*s))/k,m=f(n,
q,p,g,r,t,s,u,m,k),-1!=m&&y!=e.length-1&&s!=n&&u!=q))return{x1:n,y1:q,x2:p,y2:g,seginit:h,segfin:y,nA:C,nB:D}}else if(0===a)for(y in n=l[e[0].A].cx,q=l[e[0].A].cy,p=l[e[0].B].cx,g=l[e[0].B].cy,C=parseInt(e[0].A),D=parseInt(e[0].B),e.reverse(),e)if(0!=y&&(r=l[e[y].A].cx,t=l[e[y].A].cy,s=l[e[y].B].cx,u=l[e[y].B].cy,k=d(n,q,p,g,r,t,s,u),-1!=k&&(m=((r-s)*(n*g-q*p)-(n-p)*(r*u-t*s))/k,k=((t-u)*(n*g-q*p)-(q-g)*(r*u-t*s))/k,m=f(n,q,p,g,r,t,s,u,m,k),-1!=m&&y!=e.length-1&&p!=r&&g!=t)))return{x1:n,y1:q,x2:p,
y2:g,seginit:h,segfin:y,nA:C,nB:D}}else if(b){var H,J=[];if(3<e.length)for(y in 0===a?(h=l.length-1,D=C=a,H=a+1):a===l.length-1?(h=a-1,D=C=a,H=0):(h=a-1,D=C=a,H=a+1),e)if(parseInt(e[y].A)!==h||parseInt(e[y].B)!=C)if(parseInt(e[y].A)!==D||parseInt(e[y].B)!=H)if(n=l[h].cx,q=l[h].cy,p=l[C].cx,g=l[C].cy,r=l[e[y].A].cx,t=l[e[y].A].cy,s=l[e[y].B].cx,u=l[e[y].B].cy,k=d(n,q,p,g,r,t,s,u),-1!=k&&(m=((r-s)*(n*g-q*p)-(n-p)*(r*u-t*s))/k,k=((t-u)*(n*g-q*p)-(q-g)*(r*u-t*s))/k,m=f(n,q,p,g,r,t,s,u,m,k),-1!=m&&n!=
s&&q!=u&&J.push({x1:n,y1:q,x2:p,y2:g})),n=l[D].cx,q=l[D].cy,p=l[H].cx,g=l[H].cy,k=d(n,q,p,g,r,t,s,u),-1!=k&&(m=((r-s)*(n*g-q*p)-(n-p)*(r*u-t*s))/k,k=((t-u)*(n*g-q*p)-(q-g)*(r*u-t*s))/k,m=f(n,q,p,g,r,t,s,u,m,k),-1!=m&&n!=s&&q!=u&&J.push({x1:n,y1:q,x2:p,y2:g})),1<J.length)return J}return-1}}console.log("=============== >  Segment.js ");
var BasicGeometry=function(){return{distanceBetweenNodes:function(a,b){var c=new Coo(a[0],a[1]),d=new Coo(b[0],b[1]);return c.distance(d)},getEnclosingView:function(a){for(var b=0,c=new Coo,d=360,f=0,h=90,e=-90,l,m,v=0;v<a.length;v++)for(c=a[v],l=c[0],m=c[1],l>f&&(f=l),l<d&&(d=l),m>e&&(e=m),m<h&&(h=m),m=a.length/2;m<a.length;m++){l=a[Math.floor(m)];var w;b<(w=BasicGeometry.distanceBetweenNodes(c,l))&&(b=w)}w=[];for(v=0;v<a.length-1;v++)c=a[v],w.push(new Coo(c[0],c[1]));for(v=h=f=d=0;v<w.length;v++)a=
w[v],d+=a.x,f+=a.y,h+=a.z;d/=w.length;f/=w.length;h/=w.length;v=1/Math.sqrt(d*d+f*f+h*h);d*=v;f*=v;h*=v;c=new Coo;c.x=d;c.y=f;c.z=h;c.computeLonLat();for(v=f=d=0;v<w.length;v++)a=w[v],h=[c.lon-b/2,a.lat],0>h[0]&&(h[0]=360+h[0]),360<h[0]&&(h[0]-=360),e=[c.lon+b/2,a.lat],0>e[0]&&(e[0]=360+e[0]),360<e[0]&&(e[0]-=360),e=BasicGeometry.distanceBetweenNodes(e,[a.lon,a.lat]),b<e&&(d=e-b),h=BasicGeometry.distanceBetweenNodes(h,[a.lon,a.lat]),b<h&&(d=h-b),h=[a.lon,c.lat+b/2],90<h[1]&&(h[1]=180-h[1]),e=[a.lon,
c.lat-b/2],-90>e[1]&&(e[1]=-180+e[1]),a.lat<e[1]?f=e[1]-a.lat:a.lat>h[1]&&(f=a.lat-h[1]);return{center:{ra:c.lon-d,dec:c.lat-f},size:b}}}}();console.log("=============== >  AstroCoo.js ");
var LibraryMap=function(){this.colorMap={};this.colorMap.Simbad={color:"#d66199",catalog:"Simbad",dot:""};this.colorMap.NED={color:"orange",catalog:"NED",dot:""};this.colorMap.green_apple={color:"#00ff02",catalog:"",dot:""};this.colorMap.purple={color:"#7f00d4",catalog:"",dot:""};this.colorMap.salmon={color:"#ff9966",catalog:"",dot:""};this.colorMap.dark_bleu={color:"#0034f1",catalog:"",dot:""};this.colorMap.red_apple={color:"#ff0000",catalog:"",dot:""};this.colorMap.sky_bleu={color:"#03fffc",catalog:"",
dot:""};this.colorMap.brown={color:"#975200",catalog:"",dot:""};this.colorMap.yellow={color:"#faff00",catalog:"",dot:""};this.colorMap.argent={color:"#f3f3f3",catalog:"",dot:""}};
LibraryMap.prototype={getNextFreeColor:function(a){for(var b in this.colorMap)if(""==this.colorMap[b].catalog)return this.colorMap[b].catalog=a,this.colorMap[b];return null},freeColor:function(a){for(var b in this.colorMap)this.colorMap[b].catalog==a&&(this.colorMap[b].catalog="")},getColorByCatalog:function(a){for(var b in this.colorMap)if(this.colorMap[b].catalog==a)return this.colorMap[b]},setCatalogByColor:function(a){for(var b in this.colorMap)this.colorMap[b].color==a.color&&(this.colorMap[b].catalog=
a.catalog)}};console.log("=============== >  LibraryMap.js ");
var LibraryCatalogItem=function(a){this.id=a.id;this.url=a.url;this.name=a.name;this.nameTemp=a.nameTemp;this.color=a.color;this.shape=a.shape;this.size=a.size;this.obs_id=a.obs_id;this.fade=a.fade;this.al_refs=a.al_refs},LibraryCatalog=function(){var a=[],b=0,c={};c.catalogs=a;c.addCatalog=function(c){a[c.name]=new LibraryCatalogItem(c);var f=a[c.name],h;for(h in a)a[h].id>b&&(b=a[h].id);f.id=b+1;console.log("#####id>"+a[c.name].id+"<catalog>"+c.name+"<saved successfully");for(var e in a)console.log("library>>>>>>>>>"+
a[e].id+":"+a[e].name+">>>>name temporary:"+a[e].nameTemp)};c.getCatalog=function(b){void 0==a[b]&&console.log("catalogue >"+b+"< not found");return a[b]};c.delCatalog=function(b){delete a[b];console.log("catalog>"+b+"<deleted successfully");for(b in a)console.log("library>>>>>>>>>"+a[b].id+":"+a[b].name)};c.updCatalog=function(b){var c=b.name;b.url&&(a[c].url=b.url);b.color&&(a[c].color=b.color);b.shape&&(a[c].shape=b.shape);b.size&&(a[c].size=b.size);b.fade&&(a[c].fade=b.fade);b.al_refs&&(a[c].al_refs=
b.al_refs);b.obs_id&&(a[c].obs_id=b.obs_id);b.nameTemp&&(a[c].nameTemp=b.nameTemp);console.log("#####"+b.name+" updated successfully");"Swarm"==b.name&&SwarmDynamicFilter.runConstraint()};return c}();console.log("=============== >  LibraryCatalog.js ");var MasterResource=function(a){a&&(this.actions=a.actions,this.affichage=a.affichage,this.parseLocation(a.affichage),this.tab=[],this.filtered=void 0==a.filtered||!0!=a.filtered?!1:!0)};
MasterResource.prototype={parseLocation:function(a){if((a=a.location)&&a.url_base)this.url=a.url_base;else if(a&&a.service){if(a.url_query){var b=a.query.replace(/\{\$ra\}/g,"@@ra@@").replace(/\{\$dec\}/g,"@@dec@@").replace(/\{\$fov\}/g,"@@fov@@").replace(/\{\$format\}/g,"@@format@@");this.url=a.service+encodeURI(b).replace(/@@ra@@/g,"{$ra}").replace(/@@dec@@/g,"{$dec}").replace(/@@fov@@/g,"{$fov}").replace(/@@format@@/g,"{$format}")}}else alert("master resource malformed"),this.url=null},setParamsInUrl:function(a){var b=
null,c,b="arcmin"==a.masterResource.affichage.radiusUnit?60:"arcsec"==a.masterResource.affichage.radiusUnit?3600:1;!this.filtered&&1<a.fov?(c=1,WaitingPanel.warnFov()):c=a.fov;var d=parseInt(1E3*c*b)/1E3+1,f=Numbers.toSexagesimal(a.ra/15,8,!1),h=Numbers.toSexagesimal(a.dec,7,!1),e=a.masterResource.affichage,l=e.location;console.log(a.fov+" size = "+d+" "+f+" "+h);d=c*b;b=l.url_base;b.includes("{$query}")?(l=l.url_query,c="",!0==e.progressiveMode&&void 0!=e.progressiveLimit&&(c=e.location.url_limit,
l=l.replace("WherePosition {isInCircle({$ra} {$dec}, {$fov},-, ICRS)}","")),l=l.replace(/\{\$limitQuery\}/g,c),l=l.replace(/\{\$ra\}/g,"($ra)"),l=l.replace(/\{\$dec\}/g,"($dec)"),l=l.replace(/\{\$fov\}/g,"($fov)"),l=encodeURI(l),b=b.replace(/\{\$query\}/g,l),b=b.replace(/\{\$format\}/g,e.format),b=b.replace(/\(\$ra\)/g,"%22"+a.ra),b=b.replace(/\(\$dec\)/g,a.dec+"%22"),b=b.replace(/\(\$fov\)/g,d),console.log("######queryMode for XMM sources"),console.log("######queryEncoded>"+l)):(b=this.url.replace(/\{\$ra\}/g,
a.ra),b=b.replace(/\{\$dec\}/g,a.dec),b=b.replace(/\{\$fov\}/g,d),b=b.replace(/\{\$format\}/g,e.format));console.log(b);return b},cleanTab:function(){this.tab=[]}};console.log("=============== >  MasterResource.js ");function AladinLiteView(){this.img=this.id=this.region=this.survey=this.fov=this.dec=this.ra=this.name=null;this.XMM=!1;this.catalogTab=null;this.masterResource;this.target=[];this.reverseColor=this.colorMap=this.key=this.comment=null;this.sourceSelected={x:null,y:null}}
var objs=[],setAladinLiteView=function(a,b){objs[a.id]=new AladinLiteView;var c=objs[a.id];c.name=a.name;c.ra=a.ra;c.dec=a.dec;c.fov=a.fov;c.survey=a.survey;c.region=a.region;c.id=a.id;c.img=a.img;c.XMM=a.XMM;c.catalogTab=a.catalogTab;c.masterResource=new MasterResource(localConf.masterResource);c.target=a.target;c.comment=a.comment;c.key=b;c.colorMap=a.colorMap;c.reverseColor=a.reverseColor;c.sourceSelected=a.sourceSelected;return objs[a.id]=c},getAladinLiteView=function(a){if(void 0!=objs[a])return objs[a]},
deleteAllObjs=function(){objs=[]};
AladinLiteView.prototype={getHTMLTitle:function(){return'<div  title="replay the stored view" id="'+this.id+'" style="height:auto;"><img id="'+this.id+'_snapShot_img" src="'+this.img+'" onclick="AladinLiteX_mVc.restoreViewById(&quot;'+this.id+'&quot;);" style= "height: 18px;width: 18px;">&nbsp;&nbsp;&nbsp;</img><a title="download the snapshot" href="'+this.img+'" download ="ALIX snapshot '+this.id+'"><i class="glyphicon glyphicon-download-alt" style="vertical-align: top;color:black" ></i>   </a><i id="'+this.id+
'_link"  style="vertical-align: top;font-weight:800;">'+this.name+" | "+this.survey.ID+"</i>&nbsp;"+this.regionIcon()+"&nbsp;"+this.targetIcon()+'<button id="'+this.id+'_menu" type="edit list" title="menu" class="alix_btn alix_btn-color-his alix_btn-edit"><i class="glyphicon glyphicon-record" style="font-size:19px;position:relative;top:-4px;"></i></button><button id="'+this.id+'_menu_close_img" title="delete" class="alix_btn alix_btn-color-his alix_btn-in-edit" onclick="AladinLiteX_mVc.deleteHistory(&quot;'+
this.id+'&quot;);"><i class="glyphicon glyphicon-remove-sign" style="font-size:15px;"></i></button><button id="'+this.id+'_menu_commit" title="remark" class="alix_btn alix_btn-color-his alix_btn-in-edit" style="position:relative;left:-35px;" ><i class="glyphicon glyphicon-pencil" style="font-size:15px;"></i></button><button id="'+this.id+'_menu_show_description" title="description" class="alix_btn alix_btn-color-his alix_btn-in-edit" style="position:relative;left:-57px;"><i class="glyphicon glyphicon-info-sign" style="font-size:15px;"></i></button><textarea id="'+
this.id+'_menu_commit_text" class="alix_text-commit" style="display:none;"></textarea><button id="'+this.id+'_menu_commit_text_confirm" class="alix_btn alix_btn-text-ok alix_btn-color-ok" style="display:none;"><i class="glyphicon glyphicon-ok" style="font-size:11px;"></i></button><button id="'+this.id+'_menu_commit_text_delete" class="alix_btn alix_btn-text-remove alix_btn-color-remove" style="display:none;"><i class="glyphicon glyphicon-remove" style="font-size:11px;"></i></button><div id="'+this.id+
'_menu_commit_text_display" class="alix_menu_commit_text_display" style="">'+this.displayComment()+"</div></div>"},regionIcon:function(){return null==this.region?"":'<i  title="bookmark with region" class="glyphicon glyphicon-registration-mark" style="font-size:18;vertical-align: top;"></i>'},targetIcon:function(){return 0==this.target.length?"":'<i class="glyphicon glyphicon-star" style="vertical-align: top;color:red"></i>'},displayComment:function(){return null==this.comment?"":this.comment},setHandlers:function(){console.log("setHandlers run");
var a=this,b=!1;$("#"+this.id+"_snapShot_img").mouseover(function(a){$("#"+this.id).css("width","100px");$("#"+this.id).css("height","100px");$("#"+$(this).attr("id").replace("_snapShot_img","")).css("height","auto")});$("#"+this.id+"_snapShot_img").mouseout(function(a){$("#"+this.id).css("width","18px");$("#"+this.id).css("height","18px");$("#"+$(this).attr("id").replace("_snapShot_img","")).css("height","auto")});$("#"+this.id+"_menu").click(function(a){!1==b?($("#"+this.id+"_close_img").css("transition-timing-function",
"cubic-bezier(0.8,0.84,0.44,1.3)"),$("#"+this.id+"_close_img").css("transform","translate3d(-15px,25.98px,0px)"),$("#"+this.id+"_close_img").css("transition-duration","100ms"),$("#"+this.id+"_commit").css("transition-timing-function","cubic-bezier(0.8,0.84,0.44,1.3)"),$("#"+this.id+"_commit").css("transform","translate3d(15px,25.98px,0px)"),$("#"+this.id+"_commit").css("transition-duration","200ms"),$("#"+this.id+"_show_description").css("transition-timing-function","cubic-bezier(0.8,0.84,0.44,1.3)"),
$("#"+this.id+"_show_description").css("transform","translate3d(27px,0px,0px)"),$("#"+this.id+"_show_description").css("transition-duration","300ms"),$("#"+$(this).attr("id").replace("_menu","")).css("height","55px"),b=!0):($("#"+this.id+"_close_img").css("transition-timing-function","ease-out"),$("#"+this.id+"_close_img").css("transform","translate3d(0px,0px,0px)"),$("#"+this.id+"_close_img").css("transition-duration","200ms"),$("#"+this.id+"_commit").css("transition-timing-function","ease-out)"),
$("#"+this.id+"_commit").css("transform","translate3d(0px,0px,0px)"),$("#"+this.id+"_commit").css("transition-duration","200ms"),$("#"+this.id+"_show_description").css("transition-timing-function","ease-out"),$("#"+this.id+"_show_description").css("transform","translate3d(0px,0px,0px)"),$("#"+this.id+"_show_description").css("transition-duration","200ms"),$("#"+$(this).attr("id").replace("_menu","")).css("height","auto"),b=!1)});$("#"+this.id+"_menu_commit").click(function(b){$("#"+this.id+"_text").val(a.comment);
$("#"+this.id+"_text").css("display","inline");$("#"+this.id+"_text_confirm").css("display","inline");$("#"+this.id+"_text_delete").css("display","inline");console.log(a.comment)});$("#"+this.id+"_menu_commit_text").click(function(a){$("#"+this.id+"_confirm").css("display","inline");$("#"+this.id+"_delete").css("display","inline")});$("#"+this.id+"_menu_commit_text_delete").click(function(a){$(this).css("display","none");$("#"+$(this).attr("id").replace("_delete","_confirm")).css("display","none");
$("#"+$(this).attr("id").replace("_delete","")).css("display","none")});$("#"+this.id+"_menu_commit_text_confirm").click(function(b){$(this).css("display","none");$("#"+$(this).attr("id").replace("_confirm","_delete")).css("display","none");$("#"+$(this).attr("id").replace("_confirm","")).css("display","none");a.comment=$("#"+$(this).attr("id").replace("_confirm","")).val();$("#"+$(this).attr("id").replace("_confirm","_display")).html(a.comment);restoreLocal(a)})},clean:function(){this.catalogTab=
this.img=this.id=this.region=this.fov=this.dec=this.ra=this.name=null;this.XMM=!1}};var restoreLocal=function(a){var b=jQuery.extend(!0,{},a),b=deepClone(b),b=JSON.stringify(b);a=void 0!=a.key?a.key:new date;localStorage.setItem(a,b)};console.log("=============== >  AladinLiteView.js ");
var getSexadecimalString=function(a,b){var c=Numbers.toSexagesimal(a/15,8,!1),d=Numbers.toSexagesimal(b,7,!1);return c+" "+d},WaitingPanel=function(){var a={};return{show:function(b){console.log("SHOW "+b);$("#fetchingMessage").html("Fetching data from "+b);$("#waiting_interface").css("display","inline");a[b]=!0},hide:function(b){console.log("HIDE "+b);delete a[b];for(var c in a){$("#fetchingMessage").html("Fetching data from "+c);return}$("#waiting_interface").css("display","none")},warnNbSources:function(){WaitingPanel.warn("Number of displayed sources limited to 999")},
warnFov:function(){console.error("warnFov");$("#alert").html('<div class="alix_alert_fov_img"><i class="glyphicon glyphicon-alert" style="font-size:16px;padding:3px;"></i></div><div class="alix_alert_fov_msg">Search radius limited to 1&deg;</div>');$("#alert").fadeIn(100);setTimeout("$('#alert').fadeOut('slow')",1300)},warn:function(a){console.log("warn "+a);$("#alert").html('<div class="alix_alert_fov_msg">'+a+"</div>");$("#alert").fadeIn(100);setTimeout("$('#alert').fadeOut('slow')",1300)}}}(),
AladinLiteX_mVc=function(){var a=this,b,c,d,f,h,e,l,m,v,w,I,B,P,k,n,r,p,s,q,t,g=new AladinLiteView,u=null,C,D=function(){if(void 0!=g.masterResource&&!0==g.masterResource.actions.showAssociated.handlerDeleteSource){F("oid");for(var a=0;5>a;a++)$("#plus").trigger("click");O()}void 0!=g.masterResource&&g.masterResource.actions.externalProcessing.handlerDeselect&&g.masterResource.actions.externalProcessing.handlerDeselect();g.sourceSelected.x=null;g.sourceSelected.y=null;$("#XMM").attr("class","alix_XMM_in_menu alix_menu_item alix_datahelp_selected")},
y=function(){D();C&&C.deselectAll()},H=function(a,b,d){b=void 0!=d?d.affichage.label:"";var f;f=void 0!=d&&d.actions.showAssociated?d.actions.showAssociated.label:"";m=$("#"+v);m.html('<div id="'+l+'" class="alix_aladin_div"></div>');m.append('<div id="'+I+'" class="alix_menu_panel"><input id="'+P+'" placeholder="target" class="alix_target  alix_menu_item" ><span id="search" title="search" class="alix_search alix_menu_item glyphicon glyphicon-search" onclick="AladinLiteX_mVc.searchPosition();"></span><select  id ="'+
p+'" class="alix_menu_item alix_select"><option value="'+a.field.position+'">'+a.field.position+'</option></select><div id="menuDiv"><button id="menu" type="menu" title="open menu" class=" alix_btn_open alix_btn alix_btn-color-menu alix_menu_item " ><i id="icon_open" class="glyphicon glyphicon-list" style="font-size:18px;"></i></button><i id="credit" title="copyright-mark" class="alix_credit alix_menu_item glyphicon glyphicon-copyright-mark"></i><button id="center" type="center" title="center" class="alix_btn alix_btn-circle alix_btn-primary alix_menu_item alix_button_center" onclick="AladinLiteX_mVc.returnCenter();"><i class="glyphicon glyphicon-screenshot" style="font-size:15px;"></i></button><button id="bookMark" type="bookMark" title="bookMark" class="alix_btn alix_btn-circle alix_btn-danger alix_menu_item alix_button_bookMark" onclick="AladinLiteX_mVc.bookMark();"><i class="glyphicon glyphicon-heart" style="font-size:15px;"></i></button><button id="history" type="history" title="history" class="alix_btn alix_btn-circle alix_btn-green alix_menu_item alix_button_history alix_unselected" onclick="AladinLiteX_mVc.getHistory();"><i class="glyphicon glyphicon-book" style="font-size:15px;"></i></button><button id="region"  type="region" title="edit region" class="alix_btn alix_btn-circle alix_btn-warning alix_menu_item alix_button_region alix_unselected" onclick="AladinLiteX_mVc.regionEditor();"><i class="glyphicon glyphicon-edit" style="font-size:15px;"></i></button></div><form method = "post" onsubmit="return false;"><fieldset class="alix_image_panel alix_menu_item alix_fieldset"><legend class="alix_titlle_image alix_menu_item">Image<i id="color_map" title = "color map" style="cursor: pointer; opacity: .3;font-size: 14px; margin:8px"class="alix_menu_item glyphicon glyphicon-sunglasses" onclick = "AladinLiteX_mVc.showColorMap()"></i></legend><input type="text" id="AladinHipsImagesExplorer_mask"  placeholder="Survey" size=11 class="alix_menu_item alix_img_explorer"></input><select id="status-select" class ="alix_selector_hips alix_menu_item"></select><button id="detail"  type="detail" class="alix_menu_item alix_button_detail" onclick="AladinLiteX_mVc.showDetailByID();">Detail</button></fieldset></form><form method = "post" onsubmit="return false;"><fieldset class="alix_catalog_panel alix_menu_item alix_fieldset" ><legend class="alix_titlle_catalog alix_menu_item">Catalogs<div id="minus" style="cursor: pointer;" class="alix_minus  alix_menu_item" title = "Fade out">-</div><i id="fade" title = "fade" class="alix_menu_item glyphicon glyphicon-lamp"></i><div id="plus" style="cursor: pointer;" class=" alix_plus  alix_menu_item" title = "Fade in">+</div></legend><div><p id="XMM" title="Show/hide master sources" class="alix_XMM_in_menu alix_menu_item alix_datahelp" style="cursor: pointer;" onclick="AladinLiteX_mVc.displayDataXml();">'+
b+"</p>"+(void 0!=g.masterResource?'<i id="btn-XMM-description" title="detail" class="alix_btn-XMM-description alix_menu_item glyphicon glyphicon-info-sign alix_btn-operate-catalog" style = "color: #888a85;" onclick="AladinLiteX_mVc.showXMMDesciption();"></i>':"")+(void 0!=g.masterResource?'<i id="btn-XMM-configure" title="configure" class="glyphicon glyphicon-cog alix_btn-operate-catalog" style="color:#888a85 ;cursor: pointer;" onclick="AladinLiteX_mVc.configureCatalog(\'XMM\',this.style.color)"></i>':
"")+(void 0!=g.masterResource?'<i id="btn-XMM-flash" title = "flash" class="alix_btn-XMM-flash alix_menu_item glyphicon glyphicon-flash" onclick="AladinLiteX_mVc.XMMFlash(); "></i>':"")+'</div><div><p id="ACDS" class = "alix_acds" >'+f+'  </p><div style = ""><p id="Simbad" title="Show/hide Simbad sources" class="alix_simbad_in_menu alix_menu_item alix_datahelp" style="cursor: pointer;" onclick="AladinLiteX_mVc.displaySimbadCatalog();">Simbad</p><i id="btn-Simbad-configure" title="configure" class="glyphicon glyphicon-cog alix_btn-operate-catalog" style="color:#888a85 ;cursor: pointer;" onclick="AladinLiteX_mVc.configureCatalog(\'Simbad\',this.style.color)"></i><i id="btn-Simbad-flash" title = "flash" class=" alix_menu_item glyphicon glyphicon-flash"style="color:#888a85 ;cursor: pointer;" onclick="AladinLiteX_mVc.SimbadFlash();"></i><p id="NED" title="Show/hide Ned sources" class="alix_ned_in_menu alix_menu_item alix_datahelp" style="cursor: pointer;" onclick="AladinLiteX_mVc.displayNedCatalog();">NED</p><i id="btn-NED-configure" title="configure" class="glyphicon glyphicon-cog alix_btn-operate-catalog" style="color:#888a85 ;cursor: pointer;" onclick="AladinLiteX_mVc.configureCatalog(\'NED\',this.style.color)"></i><i id="btn-NED-flash" title = "flash" class=" alix_menu_item glyphicon glyphicon-flash" style="color:#888a85 ;cursor: pointer;" onclick="AladinLiteX_mVc.NEDFlash();"></i></div><div><input type="text" id="Aladin-Cataloge"  placeholder="Find other Catalog" size=11 class="alix_menu_item alix_cataloge_explorer "></input><select id="select_vizier" class="alix_selector_vizier alix_menu_item"></select><div id="vizier" class="alix_vizier"><ul id="vizier_list"></ul></div></fieldset></form></div></div>');
m.append('<div id="open_all" class="alix_open_all glyphicon glyphicon-chevron-right"></div>');w=$("#"+I);m.append('<div id="'+n+'" class="alix_context_panel" ><b class="alix_context" style="display: none;"> context </b></div>');m.append('<div id="waiting_interface" class="alix_waiting_interface" style="display:none;"><div class="alix_grey_bg"></div><div class="alix_fetching_data"><div class="alix_fetching_img"></div><div id="fetchingMessage" class="alix_fetching_message">fetching data...</div></div></div>');
m.append('<div id="alert" class="alix_alert_fov" style="display:none;"><div class="alix_alert_fov_img"><i class="glyphicon glyphicon-alert" style="font-size:16px;padding:3px;"></i></div><div class="alix_alert_fov_msg">Search radius limited to 1&deg;</div></div>');m.append('<div class="alix_tester" id="tester"><ul></ul></div>');k=$("#"+n);B=$("#"+P);r=$("#"+p);s=$("#AladinHipsImagesExplorer_mask");q=$("#status-select");t=$("#Aladin-Cataloge");$("#detail-cata");$("#vizier");m=$("#"+l);V(a);G();e.on("positionChanged",
function(a){!1==a.dragging&&(G(),B.val(a.ra.toFixed(4)+","+a.dec.toFixed(4)),void 0!=g.masterResource&&c.updateCatalogs(g,"position"))});e.on("zoomChanged",function(a){var b=g.fov;G();a>=b&&void 0!=g.masterResource&&c.updateCatalogs(g,"zoom")});$("#open_all").click(function(a){a.stopPropagation();W();O()});!0==a.panelState&&W();void 0!=d&&!0==d.affichage.display&&setTimeout(function(){AladinLiteX_mVc.displayDataXml()},1E3);B.val(a.field.position);B.click(function(a){a.stopPropagation()});B.bind("keypress",
function(a){13==a.which&&(null!=g.region&&c.cleanPolygon(),g.clean(),y(),a.preventDefault(),M(B.val()))});$("#input_target").bind("keypress",function(a){13==a.which&&X()});r.click(function(a){a.stopPropagation()});r.change(function(){console.log("selectdiv&&&&&&&");Y($(this).val())});s.click(function(a){a.stopPropagation()});s.keyup(function(a){if(2<=$(this).val().length||13==a.which)a=$(this).val(),c.searchHips(a,g)});q.change(function(){N($(this).val())});q.click(function(a){a.stopPropagation()});
$("#select_vizier").change(function(){console.log($(this).val()+"<<<<<add again");var a=$(this).val();Z(a)});t.keyup(function(a){(2<=$(this).val().length||13==a.which)&&aa($(this).val())});$("#menuDiv").on("click",".alix_btn_open",function(a){a.stopPropagation();$("#center").css("transition-timing-function","cubic-bezier(0.8,0.84,0.44,1.3)");$("#center").css("transform","translate3d(45px,0px,0px)");$("#center").css("transition-duration","100ms");$("#bookMark").css("transition-timing-function","cubic-bezier(0.8,0.84,0.44,1.3)");
$("#bookMark").css("transform","translate3d(90px,0px,0px)");$("#bookMark").css("transition-duration","200ms");$("#history").css("transition-timing-function","cubic-bezier(0.8,0.84,0.44,1.3)");$("#history").css("transform","translate3d(135px,0px,0px)");$("#history").css("transition-duration","300ms");$("#region").css("transition-timing-function","cubic-bezier(0.8,0.84,0.44,1.3)");$("#region").css("transform","translate3d(180px,0px,0px)");$("#region").css("transition-duration","400ms");$("#menu").addClass("alix_btn_open_2");
$("#menu").removeClass("alix_btn_open");$("#icon_open").addClass("glyphicon-remove");$("#icon_open").removeClass("glyphicon-list");$("#credit").css("display","none")});$("#menuDiv").on("click",".alix_btn_open_2",function(a){a.stopPropagation();$("#center").css("transition-timing-function","ease-out");$("#center").css("transform","translate3d(0px,0px,0px)");$("#center").css("transition-duration","100ms");$("#bookMark").css("transition-timing-function","ease-out");$("#bookMark").css("transform","translate3d(0px,0px,0px)");
$("#bookMark").css("transition-duration","200ms");$("#history").css("transition-timing-function","ease-out");$("#history").css("transform","translate3d(0px,0px,0px)");$("#history").css("transition-duration","300ms");$("#region").css("transition-timing-function","ease-out");$("#region").css("transform","translate3d(0px,0px,0px)");$("#region").css("transition-duration","400ms");$("#menu").addClass("alix_btn_open");$("#menu").removeClass("alix_btn_open_2");$("#icon_open").addClass("glyphicon-list");
$("#icon_open").removeClass("glyphicon-remove");$("#credit").css("display","inline")});$("#vizier").click(function(a){a.stopPropagation()});$(".alix_target_selecte").click(function(a){if("alix_target_selecte alix_unselected"==$(this).attr("class")){for(a=0;a<g.target.length;a++){var b=a,c=g.target[a].ct,z=g.target[a].ra,d=g.target[a].dec;e.addCatalog(c);c.addSources([A.marker(z,d,{popupTitle:"target"},b)])}$(this).attr("class","alix_target_selecte alix_selected");$(this).css("color","#87F6FF")}else F("target"),
$(this).attr("class","alix_target_selecte alix_unselected"),$(this).css("color","#888a85")});$(".alix_select_trash").click(function(a){$(".alix_target_selecte").css("display","none");$(this).css("display","none");$(".alix_select_flash").css("display","none");F("target")});$(".alix_select_flash").click(function(a){for(a=0;a<g.target.length;a++)g.target[a].ct.makeFlash()});$("#credit").click(function(a){E();k.css("max-height","200px");100>k.height()?(k.animate({height:"200px"},"fast"),k.css("border-width",
"0.2px")):(k.animate({height:"0px"},"fast"),k.css("border-width","0px"));$.getJSON("http://saada.unistra.fr/alix/licences/credit.json",function(a){k.html("<pre>"+JSON.stringify(a,null,2)+"</pre>")})});void 0!=d&&d.actions.externalProcessing.handlerInitial&&(console.log("handlerInitial"),d.actions.externalProcessing.handlerInitial())},J=function(a){e.getRaDec();a="http://alasky.unistra.fr/MocServer/query?RA=23&DEC=33&SR="+e.getFov()[0]+"&fmt=json&get=record&casesensitive=false";var b=RegExp(/.*((jpeg)|(png)).*/);
$.getJSON(a,function(a){for(var z=a.length-1;0<=z;z--)"image"!=a[z].dataproduct_type&&a.splice(z,1);for(z=a.length-1;0<=z;z--){var e=0;if($.isArray(a[z].hips_tile_format))for(var f=0;f<a[z].hips_tile_format.length;f++){if(b.test(a[z].hips_tile_format[f])){e=1;break}}else b.test(a[z].hips_tile_format)&&(e=1);0==e&&a.splice(z,1)}c.modules.hipsSelectorModel.storeHips(a);e=!1;for(z=0;z<a.length;z++)f=a[z].ID,f==d&&(N(f),Q(f),e=!0);e||(N("CDS/P/DSS2/color"),Q("CDS/P/DSS2/color"))})},V=function(a){if(null!=
e)for(var c=0;c<e.view.overlays.length;c++)if("Reference Frame"==e.view.overlays[c].name){e.view.overlays[c].removeAll();break}void 0!=a.defaultSurvey&&(d=a.defaultSurvey);void 0!=a.region?("array"==a.region.type?x=b.regionEditor.view.parseArrayPolygon(a.region.value):"soda"==b.regionEditor.view.editionFrame.type?x=this.controllers.regionEditor.view.parseSodaPolygon(a.region.value):alert("Polygone format "+points.type+" not understood"),x&&(a=BasicGeometry.getEnclosingView(x),h=a.center.ra+" "+a.center.dec,
f=1.2*a.size,null==e&&(e=A.aladin(m,{survey:d,fov:f,showLayersControl:!1,showFullscreenControl:!1,showFrame:!1,showGotoControl:!1}),m.append()),e.setZoom(f),e.gotoPosition(a.center.ra,a.center.dec),overlay=A.graphicOverlay({color:"blue",name:"Reference Frame"}),e.addOverlay(overlay),overlay.addFootprints([A.polygon(x)]))):(void 0!=a.field?(f=void 0!=a.field.defaultFov?a.field.defaultFov:0.9,h=void 0!=a.field.position?a.field.position:"M51"):(h="M51",f=0.9),null==e&&(e=A.aladin(m,{survey:d,fov:f,showLayersControl:!1,
showFullscreenControl:!1,showFrame:!1,showGotoControl:!1}),m.append()),ja(h),setTimeout(function(){e.setZoom(f)},200));J()},R=!1,K=!1,L=!1,E=function(){!1==browseSaved&&(!0==confirm("Do you want to save your polygon?")?$("#regionEditor_a").trigger("click"):(browseSaved=null,c.cleanPolygon()))},ba=function(a){null!=g.region&&c.cleanPolygon();g=jQuery.extend(!0,{},a);B.val(g.name);e.gotoRaDec(g.ra,g.dec);e.setFoV(g.fov);N(g.survey.ID);q.val(g.survey.ID);null!=g.region&&(S||c.editRegion(),a={type:null,
value:[]},a.type=g.region.format,a.value=g.region.points,c.setInitialValue(a))},ca=function(a,b){var c=e.view.closestObjects(a,b,5);if(c){c=c[0];c instanceof Footprint||c instanceof Circle?c.dispatchClickEvent():c.marker?(e.view.popup.setTitle(c.popupTitle),e.view.popup.setText(c.popupDesc),e.view.popup.setSource(c),e.view.popup.show()):(e.view.lastClickedObject&&e.view.lastClickedObject.actionOtherObjectClicked&&e.view.lastClickedObject.actionOtherObjectClicked(),c.actionClicked());e.view.lastClickedObject=
c;var d=e.view.aladin.callbacksByEventName.objectClicked;"function"===typeof d&&d(c)}else e.view.lastClickedObject&&(e.view.aladin.measurementTable.hide(),e.view.popup.hide(),e.view.lastClickedObject instanceof Footprint||e.view.lastClickedObject.actionOtherObjectClicked(),e.view.lastClickedObject=null,d=e.view.aladin.callbacksByEventName.objectClicked,"function"===typeof d&&d(null))},G=function(){var a=e.getRaDec();g.name=B.val();g.ra=a[0];g.dec=a[1];a=e.getFov();g.fov=a[0];g.img=e.getViewDataURL({width:400,
height:400});g.catalogTab=c.currentCatalogTab(e.view.catalogs);g.colorMap=e.view.imageSurvey.getColorMap().mapName;g.reverseColor=e.view.imageSurvey.getColorMap().reversed;var a=Numbers.toSexagesimal(g.ra/15,8,!1),b=Numbers.toSexagesimal(g.dec,7,!1);console.log("@@@@@@@@@@@@@@ storeCurrentState "+a+" "+b)},S=!1,M=function(a,b){r.val(a);B.val(a);e.gotoObject(a,{success:function(d){g.name=B.val();g.ra=d[0];g.dec=d[1];d=Numbers.toSexagesimal(g.ra/15,8,!1);var f=Numbers.toSexagesimal(g.dec,7,!1);console.log("@@@@@@@@@@@@@@ gotoObject "+
d+" "+f);d=e.getFov();g.fov=d[0];c.updateCatalogs(g,"position");da(a);b&&b()},error:function(){alert("pas connu")}})},W=function(){100>w.width()?(w.animate({width:"+=240px"},"fast"),$(".alix_menu_item").css("display","inline"),$("#open_all").animate({left:"+=240px"},"fast"),$("#open_all").attr("class","alix_open_all glyphicon glyphicon-chevron-left")):(w.animate({width:"-=240px"},"fast"),$(".alix_menu_item").css("display","none"),$("#open_all").animate({left:"-=240px"},"fast"),$("#open_all").attr("class",
"alix_open_all glyphicon glyphicon-chevron-right"))},O=function(){E();k.css("max-height","200px");99<k.height()&&(k.animate({height:"0px"},"fast"),k.css("border-width","0px"),$(".alix_context").css("display","none"),k.html(""),B.val(g.name))},Z=function(a){if(LibraryCatalog.getCatalog("VizieR:"+a)){var b=!1;$("#vizier_list").find("li").each(function(){$(this).hasClass(a)&&(console.log("VizieR:"+a+"exists already in library Catalog and is shown"),b=!0)});!1==b&&(c.createCatalogSelect(a),console.log("VizieR:"+
a+"exists already in library Catalog but not shown"))}else console.log("catalogfunction"+a),c.createCatalogSelect(a),ka(a);$("#itemList").css("display","none")},N=function(a){a=c.getSelectedHips(a);g.survey=a;if(void 0===a)console.error("unknown HiPS");else{$("#itemList").css("display","none");var b="",b=0<=a.hips_tile_format.indexOf("png")?"png":"jpg";a=""!=b?e.createImageSurvey(a.obs_title,a.obs_title,a.hips_service_url,a.hips_frame,a.hips_order,{imgFormat:b}):e.createImageSurvey(a.obs_title,a.obs_title,
a.hips_service_url,a.hips_frame,a.hips_order,void 0);e.setImageSurvey(a,void 0)}},Q=function(a){for(var b=document.getElementById("status-select"),d=b.options.length,e=0;e<d;e++)if(b.options[e].text==a)return!1;c.modules.historicModel.hips_tab.push(a);b='<select id="status" class ="alix_selector_hips alix_menu_item">'+("<option value='"+a+"'>"+a+"</option>");for(d=0;d<c.modules.historicModel.hips_tab.length;d++)c.modules.historicModel.hips_tab[d]!=a&&(b+="<option value='"+c.modules.historicModel.hips_tab[d]+
"'>"+c.modules.historicModel.hips_tab[d]+"</option>");q.html(b+"</select>")},da=function(a){for(var b=document.getElementById("aladin-lite-div-select"),c=b.options.length,d=0;d<c;d++)if(b.options[d].text==a)return!1;""!=a&&(r.append("<option>"+a+"</option>"),r.val(a))},ka=function(a){var b=document.getElementById("select_vizier"),c=b.options.length;$("#select_vizier").val(a);for(var d=0;d<c;d++)if(b.options[d].text==a)return!1;a="<option>"+a+"</option>";$("#select_vizier").append(a)},ea=function(a){k.css("max-height",
"200px");var b=c.getSelectedHips(a);void 0!=b?(a='<p style="color:#4D36DC;margin:10px;" >'+(b.obs_title+"</p><span style='font-size:small;color : #727371;margin:10px;'>"+a+"</span><p style='font-size:small;margin:10px;font-weight:200;line-height:1.5;color:#000000;'>&nbsp;&nbsp;"+b.obs_description+"<br>"),a+="</p>",100<k.height()||(k.animate({height:"200px"},"fast"),k.css("border-width","0.2px")),k.html(a)):alert("Please enter a survey ID")},fa=function(a){E();k.css("max-height","200px");100<k.height()?
(k.animate({height:"0px"},"fast"),k.css("border-width","0px")):ea(a)},ga=function(a,b){console.log("displayCatalogDetailInContext");if(100<k.height())k.animate({height:"0px"},"fast"),k.css("max-height","200px"),k.css("border-width","0px");else{var d=c.getSelectedCatalog(a),e=a.split("/");e.pop();e=e.join("/");console.log("obs_id="+a);console.log("index="+e);void 0!=d?(d='<iframe id = "cds_iframe"  name="content_frame" marginwidth=0 marginheight=0 width=100% height=400 src="http://cdsarc.u-strasbg.fr/viz-bin/ReadMe/'+
e+'/?format=html&tex=true" frameborder="0"style = "box-shadow: 0 0 20px 2px '+b+'; margin-left: 5px;" ></iframe>',100<k.height()||(k.animate({height:"400px"},"fast"),k.css("max-height","400px"),k.css("border-width","0.2px")),k.html(d)):alert("Please choose a catalog")}},aa=function(a){c.searchCataloge(a,g)},Y=function(a){a=a?a:B.val();null!=g.region&&c.cleanPolygon();g.clean();M(a)},T=function(a){E();k.css("max-height","200px");39<k.height()?k.css("height","101px"):(k.animate({height:"101px"},"fast"),
k.css("border-width","0.2px"));k.html(a)},U=function(){$("#minus").unbind("click").click(function(a){console.log("minus");for(var b in LibraryCatalog.catalogs){b.startsWith("Swarm")&&(b="Swarm");b.startsWith("Simbad")&&(b="Simbad");b.startsWith("NED")&&(b="NED");var c=LibraryCatalog.getCatalog(b);a=c.al_refs;var d=a.color;console.log("catalog:"+b+",original color:"+c.color+",current color:"+d);"orange"==d&&(d="#ffa500");"red"==d&&(d="#ff0000");c=ha(d);a.updateShape({color:c})}});$("#plus").unbind("click").click(function(a){console.log("plus");
for(var b in LibraryCatalog.catalogs){var c=LibraryCatalog.catalogs[b];b.startsWith("Swarm")&&(b="Swarm");b.startsWith("Simbad")&&(b="Simbad");b.startsWith("NED")&&(b="NED");c=LibraryCatalog.getCatalog(b);a=c.color;var c=c.al_refs,d=c.color;console.log("catalog:"+b+",original color:"+a+",current color:"+d);"orange"==d&&(d="#ffa500");"red"==d&&(d="#ff0000");"orange"==a&&(a="#ffa500");"red"==a&&(a="#ff0000");a=ia(d,a);c.updateShape({color:a})}})},F=function(a){if("all"==a){for(var b=0;b<e.view.catalogs.length;b++)e.view.catalogs.splice(b,
1),e.view.mustClearCatalog=!0,b--;e.view.requestRedraw();$("#XMM").attr("class","alix_XMM_in_menu alix_menu_item alix_datahelp");$("#XMM").css("color","#888a85");$("#btn-XMM-flash").css("color","#888a85");$("#btn-XMM-description").css("color","#888a85");$("#btn-XMM-configure").css("color","#888a85");$("#ACDS").css("display","none");$("#Simbad").attr("class","alix_simbad_in_menu alix_menu_item alix_datahelp");$("#Simbad").css("color","#888a85");$("#btn-Simbad-flash").css("color","#888a85");$("#btn-Simbad-configure").css("color",
"#888a85");$("#NED").attr("class","alix_ned_in_menu alix_menu_item alix_datahelp");$("#NED").css("color","#888a85");$("#btn-NED-flash").css("color","#888a85");$("#btn-NED-configure").css("color","#888a85")}for(b=0;b<e.view.catalogs.length;b++)e.view.catalogs[b].name.startsWith(a)&&(e.view.catalogs.splice(b,1),e.view.mustClearCatalog=!0,e.view.requestRedraw(),b--)},ha=function(a){console.log("fadeout"+a);var b=a.replace(/\#/g,"").match(/.{2}/g);a=[3];for(var c=0;c<b.length;c++)1<parseInt(b[c],16)?
a[c]=parseInt(parseInt(b[c],16)/2):a[c]=1;b="#";for(c=0;c<a.length;c++)b=1==a[c].toString(16).length?b+("0"+a[c].toString(16)):b+a[c].toString(16);return b},ia=function(a,b){console.log("fadein"+a);var c=a.replace(/\#/g,"").match(/.{2}/g),d=[3];d[0]=parseInt(2*parseInt(c[0],16));d[1]=parseInt(2*parseInt(c[1],16));d[2]=parseInt(2*parseInt(c[2],16));var e=b.replace(/\#/g,"").match(/.{2}/g),c=[3];c[0]=parseInt(e[0],16);c[1]=parseInt(e[1],16);c[2]=parseInt(e[2],16);for(var e="#",f=0;f<d.length;f++)d[f]>
c[f]&&(d[f]=c[f]),e=1==d[f].toString(16).length?e+("0"+d[f].toString(16)):e+d[f].toString(16);return e},X=function(a){var b=$("#input_target").val();M(b,function(){var b;a:{for(b=0;b<e.view.catalogs.length;b++)if("target"==e.view.catalogs[b].name){b=e.view.catalogs[b];break a}b=null}null==b&&(b=A.catalog({name:"target",color:"green"}),e.addCatalog(b));var d=e.getRaDec();b.addSources([A.marker(d[0],d[1],{popupTitle:"target: "+d[0]+", "+d[1]})]);g.target.push({ra:d[0],dec:d[1],ct:b});c.updateCatalogs(g,
"position");$(".alix_target_selecte").css("display","inline");$(".alix_target_selecte").css("color","#87F6FF");$(".alix_target_selecte").attr("class","alix_target_selecte alix_selected");$(".alix_select_flash").css("display","inline");$(".alix_select_trash").css("display","inline");null!=a&&a(d[0],d[1])})},ja=function(a){da(a);B.val(a);Sesame.resolve(a,function(a){e.gotoPosition(a.Target.Resolver.jradeg,a.Target.Resolver.jdedeg);J()},function(b){console&&(console.log("Could not resolve object name "+
a),console.log(b));"function"===typeof errorCallback&&errorCallback()})};return{popup:function(){!0==R?($("#aladin-lite-div").closest(".ui-dialog-content").dialog("close"),R=!1):(100>w.width()?$("#aladin-lite-div").dialog({title:"AladinLiteX",height:450,width:440}):100>k.height()?$("#aladin-lite-div").dialog({title:"AladinLiteX",height:450,width:680}):$("#aladin-lite-div").dialog({title:"AladinLiteX",height:650,width:680}),R=!0)},refresh:function(){M(h);e.setFov(f);$("#aladin-lite-div").dialog({title:"AladinLiteX",
height:450,width:440})},init:function(d){v=d.parentDivId;l=d.parentDivId+"-main";I=d.parentDivId+"-menu";n=d.parentDivId+"-context";P=d.parentDivId+"-target";p=d.parentDivId+"-select";g.masterResource=void 0!=d.masterResource?new MasterResource(d.masterResource):null;void 0!=d.controllers.historic&&(d.controllers.historic.model=new Historique_Mvc(n,this));if(void 0!=d.controllers.regionEditor||void 0!=d.defaultView&&void 0!=d.defaultView.region)d.controllers.regionEditor.view=new RegionEditor_mVc(this,
v,n,function(a){a.userAction&&(AladinLiteX_mVc.storePolygon(a.region),alert(JSON.stringify(a)))},d.defaultView.defaultRegion);void 0!=d.controllers.hipsSelector&&(d.controllers.hipsSelector.model=new HipsSelector_Mvc(v,this));b=d.controllers;c=new AladinLite_mvC(a,d.controllers);H(d.defaultView,d.controllers,d.masterResource)},showDetailByID:function(){E();var a=q.val();fa(a)},fadeOutAuto:function(){$("#minus").trigger("click")},deleteSourceAuto:D,deselectSource:y,closeContext:O,returnCenter:function(){E();
M(h);c.cleanPolygon()},bookMark:function(){E();k.css("max-height","200px");200>k.height()&&(k.css("height","auto"),k.css("border-width","0.2px"),height_ul=$("#history_ul").height()+80);console.log(height_ul);g.XMM=!1;for(var a=0;a<e.view.catalogs.length;a++)e.view.catalogs[a].name.startsWith("Swarm")&&(g.XMM=!0);G();c.bookMark(g)},getHistory:function(){E();k.css("max-height","200px");c.getHistory();console.log("hello"+$("#history_ul").height());10>k.height()?(k.css("height","auto"),k.css("border-width",
"0.2px"),K=!0,L=!1):10<k.height()&&(K?(k.animate({height:0},"fast"),K=!1):(k.css("height","auto"),k.css("border-width","0.2px"),K=!0),L=!1)},restoreView:ba,regionEditor:function(){E();k.css("max-height","200px");G();k.html("");10>k.height()?(c.editRegion(),k.animate({height:"101px"},"fast"),k.css("border-width","0.2px"),K=!1,S=L=!0):50<=k.height()&&(L?(k.animate({height:"0px"},"fast"),k.css("border-width","0px"),K=L=!1):(c.editRegion(),k.animate({height:"101px"},"fast"),L=!0,K=!1,S=!0))},addOverlayer:function(a){e.addOverlay(a)},
world2pix:function(a,b){return e.world2pix(a,b)},pix2world:function(a,b){return e.pix2world(a,b)},disabledButton:function(){document.getElementById("bookMark").disabled=!0;document.getElementById("history").disabled=!0;document.getElementById("center").disabled=!0},reabledButton:function(){document.getElementById("bookMark").disabled=!1;document.getElementById("history").disabled=!1;document.getElementById("center").disabled=!1},storePolygon:function(a){g.region=a},deleteHistory:function(a){c.deleteHistory(a)},
restoreViewById:function(a){F("all");a=c.restoreViewById(a);ba(a);null!=a.catalogTab&&c.buildCataTab(a);!0==g.XMM&&c.displayDataXml(g);a='<select id="status" class ="alix_selector_hips alix_menu_item">'+("<option value='"+g.survey.ID+"'>"+g.survey.ID+"</option>");for(var b=0;b<c.modules.historicModel.hips_tab.length;b++)c.modules.historicModel.hips_tab[b]!=g.survey.ID&&(a+="<option value='"+c.modules.historicModel.hips_tab[b]+"'>"+c.modules.historicModel.hips_tab[b]+"</option>");q.html(a+"</select>");
if(0<g.target.length)for(a=0;a<g.target.length;a++){var b=g.target[a].ra,d=g.target[a].dec,f=A.catalog({name:"target",color:"green"});e.addCatalog(f);f.addSources([A.marker(b,d,{popupTitle:"target"})])}e.view.imageSurvey.getColorMap().update(g.colorMap);g.reverseColor&&e.view.imageSurvey.getColorMap().reverse();if(g.sourceSelected.x&&g.sourceSelected.y){WaitingPanel.show("the selected source");var h=g.sourceSelected.x,l=g.sourceSelected.y;setTimeout(function(){ca(h,l);WaitingPanel.hide("the selected source")},
2500)}},hipsFunction:function(a){N(a);Q(a);ea(a)},searchCataloge:aa,searchPosition:Y,catalogFunction:Z,displayCatalogDetailInContext:ga,displaySimbadCatalog:function(){c.displaySimbadCatalog()},displayNedCatalog:function(){G();c.displayNedCatalog(g)},detailCatalogOperator:function(a){E();var b=$("#cata_operate_"+a).text();a=document.getElementById("cata_operate_"+a).style.color;console.log("gggg"+a);ga(b,a)},configureCatalog:function(a,b){function c(a){a=Number(a).toString(16);2>a.length&&(a="0"+
a);return a}console.log("obs_id="+a);var d,e,f;"XMM"==a?(console.log("XMMplay"),LibraryCatalog.getCatalog("Swarm")&&(d=LibraryCatalog.getCatalog("Swarm").al_refs),e=a,f="red"==b?"rgb(255,0,0)":b):"Simbad"==a||"NED"==a?(console.log("SNplay"),console.log("NEDcolor"+b),LibraryCatalog.getCatalog(a)&&(d=LibraryCatalog.getCatalog(a).al_refs),e=a,f="red"==b?"rgb(255,0,0)":"orange"==b?"rgb(255,165,0)":b):(console.log("Vizierplay"),e=$("#cata_operate_"+a).text(),d=$("#cata_operate_"+a).text(),d=LibraryCatalog.getCatalog("VizieR:"+
d).al_refs,f=document.getElementById("cata_operate_"+a).style.color);f=f.substring(4,f.length-1);f=f.split(",");f=function(a,b,d){return"#"+c(a)+c(b)+c(d)}(f[0],f[1],f[2]);100<k.height()?(k.animate({height:"0px"},"fast"),k.css("max-height","200px"),k.css("border-width","0px")):void 0!=d?(e='<div id="'+e+'"class="'+a+'" style = "box-shadow: 0 0 20px 2px '+f+' ;height=140px; margin-left: 5px; height: 140px;"><div class="alix_configurationShape" ><b>Shape:</b><i id="shape_plus" title="plus" class="glyphicon glyphicon-plus alix_shapeChoice " style="cursor: pointer;" onclick="AladinLiteX_mVc.updateShapeOfCatalog(this.title,this.id)"></i><i id="shape_cross" title="cross" class="glyphicon glyphicon-remove alix_shapeChoice " style="cursor: pointer;" onclick="AladinLiteX_mVc.updateShapeOfCatalog(this.title,this.id)"></i><i id="shape_circle" title="circle" class="glyphicon glyphicon-record alix_shapeChoice " style="cursor: pointer;" onclick="AladinLiteX_mVc.updateShapeOfCatalog(this.title,this.id)"></i><i id="shape_triangle" title="triangle" class="glyphicon glyphicon-triangle-top alix_shapeChoice" style="cursor: pointer;" onclick="AladinLiteX_mVc.updateShapeOfCatalog(this.title,this.id)"></i><i id="shape_rhomb" title="rhomb" class="glyphicon glyphicon-unchecked alix_shapeChoice " style="cursor: pointer;transform: rotate(45deg);" onclick="AladinLiteX_mVc.updateShapeOfCatalog(this.title,this.id)"></i><i id="shape_square" title="square" class="glyphicon glyphicon-stop alix_shapeChoice" style="cursor: pointer;" onclick="AladinLiteX_mVc.updateShapeOfCatalog(this.title,this.id)"></i></div><div class="alix_configurationShape"><b>Size:</b><div id="sliderBox"><span class="alix_min-value">1</span><input id="slider_Shape" class=" alix_slider_Shape"  type="range" step="1" value="8" min="1" max="50" oninput="AladinLiteX_mVc.updateSizeOfCatalog(this.value,this.id)"><span class="alix_max-value">50</span><span class="range-value" id="range-value0"></span></div></div><div class="alix_configurationShape"><b>Color:  </b><input id="colorSelect" type = "text" style = "margin-left: 15px;"></input></div></div>',
100<k.height()||(k.animate({height:"150px"},"fast"),k.css("max-height","200px"),k.css("border-width","0.2px")),k.html(e),$("#colorSelect").spectrum({color:f,preferredFormat:"hex3",showInput:!0,showPalette:!0,palette:[["red","rgba(0, 255, 0, .5)","rgb(0, 0, 255)"]],change:function(a){AladinLiteX_mVc.updateColorOfCatalog(a.toHexString(),"colorSelect")}})):alert("Please choose a catalog")},displayDataXml:function(){E();G();k.html("");O();c.displayDataXml(g)},XMMFlash:function(){null!=u&&u.makeFlash()},
SimbadFlash:function(){if(LibraryCatalog.getCatalog("Simbad"))var a=LibraryCatalog.getCatalog("Simbad").al_refs;null!=a&&a.makeFlash()},NEDFlash:function(){if(LibraryCatalog.getCatalog("NED"))var a=LibraryCatalog.getCatalog("NED").al_refs;null!=a&&a.makeFlash()},showXMMDesciption:function(){var a="No description";void 0!=g.masterResource&&g.masterResource.affichage.description&&(a=g.masterResource.affichage.description);html='<p style="color:#4D36DC;margin:10px;">XMM-Newton Catalog</p><p style="font-size:small;margin:10px;font-weight:200;line-height:1.5;color:#000000;">'+
a+"</p>";100<k.height()?(k.animate({height:"0px"},"fast"),k.css("border-width","0px")):T(html)},bindToFade:U,displayCatalog:function(a,b,c,d,f){var h,l=8;if("Simbad"==a){var k="square";LibraryCatalog.getCatalog(a)&&(b=LibraryCatalog.getCatalog(a).color,l=LibraryCatalog.getCatalog(a).al_refs.sourceSize,k=LibraryCatalog.getCatalog(a).al_refs.shape);h=A.catalogHiPS(d,{onClick:c,name:a,color:b,sourceSize:l,shape:k},WaitingPanel.hide(a))}else"NED"==a?(k="square",LibraryCatalog.getCatalog(a)&&(b=LibraryCatalog.getCatalog(a).color,
l=LibraryCatalog.getCatalog(a).al_refs.sourceSize,k=LibraryCatalog.getCatalog(a).al_refs.shape),h=0.02<e.getFov()[0]?A.catalogFromNED(e.getRaDec()[0]+" "+e.getRaDec()[1],0.02,{onClick:c,name:a,color:b,sourceSize:l,shape:k},function(){WaitingPanel.hide(a)}):A.catalogFromNED(e.getRaDec()[0]+" "+e.getRaDec()[1],e.getFov()[0],{onClick:c,name:a,color:b,sourceSize:l,shape:k},function(){WaitingPanel.hide(a)})):"Swarm"==a&&(g.masterResource.cleanTab(),F("Target"),F("Swarm"),console.log("@@@@@@@@@ "+d),k=
"plus",LibraryCatalog.getCatalog(a)&&(b=LibraryCatalog.getCatalog(a).al_refs.color,l=LibraryCatalog.getCatalog(a).al_refs.sourceSize,k=LibraryCatalog.getCatalog(a).al_refs.shape),h=u=A.catalogFromURL(d,{name:a,sourceSize:l,shape:k,color:b,onClick:function(a){C=this;g.sourceSelected.x=a.x;g.sourceSelected.y=a.y;var b=a.data;console.log(a);a=g.masterResource.actions.showPanel.active;console.log("&&&&&&"+g.masterResource+"and"+typeof g.masterResource.actions.externalProcessing);g.masterResource&&"function"==
typeof g.masterResource.actions.externalProcessing.handlerSelect&&g.masterResource.actions.externalProcessing.handlerSelect(b,a);var c=a="",d;for(d in b)a+="<td >"+d+"</td>",c+="<td >"+b[d]+"</td>";d="<table class='dataTable' border=1 style='font-size: small;display:none;'><tr style='font-weight: bold;'>"+a+"</tr><tr align=center>"+c+"</tr></table>";void 0!=g.masterResource&&!0==g.masterResource.actions.showPanel.active?(T(d),$(".dataTable").css("display","table")):(console.log("none"),$(".dataTable").css("display",
"none"));if(void 0==f||g.masterResource.actions.showAssociated){F("Target");F("oid");d=A.catalog({name:"Target"});e.addCatalog(d);var h=/\{\$(.*)\}/g.exec(g.masterResource.actions.showAssociated.url)[1],m=b[h],b=RegExp("\\{\\$"+h+"\\}","g");d=g.masterResource.actions.showAssociated.url.replace(b,m);console.log(b+" "+h+" "+m+" "+d);!0==g.masterResource.actions.showAssociated.active&&($("#XMM").attr("class","alix_XMM_in_menu alix_menu_item alix_datahelp"),$("#"+m).css("color","#32FFEC"),$.getJSON(d,
function(a){var b=A.catalog({name:h+" "+m,sourceSize:l,color:"#32FFEC",shape:k,onClick:"showTable"});e.addCatalog(b);for(var c=0;c<a.CounterParts.length;c++){var d=a.CounterParts[c].source;b.addSources([A.source(d.position.ra,d.position.dec,{ra:Numbers.toSexagesimal(d.position.ra/15,7,!1),dec:Numbers.toSexagesimal(d.position.dec,7,!0),Name:d.name,Description:d.description})])}!0==g.masterResource.actions.showAssociated.handlerFadeOut&&AladinLiteX_mVc.fadeOutAuto()}))}else T(d);return!0}},function(){SwarmDynamicFilter.runConstraint(g);
WaitingPanel.hide("Swarm")}),U());e.addCatalog(h);F("oid");LibraryCatalog.getCatalog(a)?LibraryCatalog.updCatalog({url:d,name:a,nameTemp:e.view.catalogs[e.view.catalogs.length-1].name,color:b,shape:k,fade:"",al_refs:h}):LibraryCatalog.addCatalog({url:d,name:a,nameTemp:e.view.catalogs[e.view.catalogs.length-1].name,color:b,shape:k,fade:"",al_refs:h})},cleanCatalog:F,displayVizierCatalog:function(a,b,c,d){var f,h=8,g="square";LibraryCatalog.getCatalog("VizieR:"+a)&&(b=LibraryCatalog.getCatalog("VizieR:"+
a).al_refs.color,h=LibraryCatalog.getCatalog("VizieR:"+a).al_refs.sourceSize,g=LibraryCatalog.getCatalog("VizieR:"+a).al_refs.shape);void 0!=d?f=A.catalogHiPS(d,{onClick:c,name:"VizieR:"+a,color:b,sourceSize:h,shape:g},WaitingPanel.hide(a)):(f=null,$.ajax({url:"http://alasky.u-strasbg.fr/footprints/estimate-nbrows/estimate-radius",data:{viz_table_id:a,ra:e.getRaDec()[0],dec:e.getRaDec()[1],nb_min:1E3,nb_max:2E3},method:"GET",async:!1,dataType:"text",success:function(c){console.log("reponse serveur "+
c);var d=Math.sqrt(e.getFov()[0]*e.getFov()[0]+e.getFov()[1]*e.getFov()[1])/2;c=parseFloat(c);console.log("radius estime: "+c+" rayon AL: "+d);if(0>d)return alert("displayVizierCatalog : Sorry, rayon AL is negative = "+d+"radius estime: "+c),!1;c>d?c=d:WaitingPanel.warn("Search radius reduced to "+Math.round(600*c)/10+"arcmin to get less than 2000 sources");console.log("radius pris "+c);console.log("querying "+a+" "+getSexadecimalString(e.getRaDec()[0],e.getRaDec()[1])+" over "+c);WaitingPanel.show(a);
f=A.catalogFromVizieR(a,e.getRaDec()[0]+" "+e.getRaDec()[1],c,{onClick:"showTable",color:b,sourceSize:h,shape:g},function(b){console.log(" En direct depuis AL: "+b.length+" sources affichees");WaitingPanel.hide(a)})},error:function(a,b,c){WaitingPanel.warn(a.responseText)}}));e.addCatalog(f);LibraryCatalog.getCatalog("VizieR:"+a)?LibraryCatalog.updCatalog({url:d,name:"VizieR:"+a,nameTemp:e.view.catalogs[e.view.catalogs.length-1].name,obs_id:a,color:b,shape:g,fade:"",al_refs:f}):LibraryCatalog.addCatalog({url:d,
name:"VizieR:"+a,nameTemp:e.view.catalogs[e.view.catalogs.length-1].name,obs_id:a,color:b,shape:g,fade:"",al_refs:f});U();for(c=0;c<e.view.catalogs.length;c++)console.log("aladinview>>>>>>>>>>>>>"+c+":"+e.view.catalogs[c].name);return f},showDetail:fa,storeCurrentState:G,colorFadeOut:ha,colorFadeIn:ia,displayTarget:X,getCurrentView:function(){return g},setReferenceView:V,updateColorOfCatalog:function(a,b){var c=document.getElementById(b).parentNode.parentNode,d=c.className;c.style.boxShadow="0 0 20px 2px "+
a;"XMM"==d?(catalog=LibraryCatalog.getCatalog("Swarm").al_refs,$("#"+d).css("color",a),$("#btn-"+d+"-description").css("color",a),$("#btn-"+d+"-configure").css("color",a),$("#btn-"+d+"-flash").css("color",a),LibraryCatalog.updCatalog({name:"Swarm",color:a})):"Simbad"==d||"NED"==d?(catalog=LibraryCatalog.getCatalog(d).al_refs,$("#"+d).css("color",a),$("#btn-"+d+"-configure").css("color",a),$("#btn-"+d+"-flash").css("color",a),LibraryCatalog.updCatalog({name:d,color:a})):(c=$("#cata_operate_"+d).text(),
catalog=LibraryCatalog.getCatalog("VizieR:"+c).al_refs,$("#cata_operate_"+d).css("color",a),$("#btn_detail_catalog_"+d).css("color",a),$("#btn_flash_catalog_"+d).css("color",a),$("#btn_configure_catalog_"+d).css("color",a),$("#btn_delete_catalog_"+d).css("color",a),LibraryCatalog.updCatalog({name:"VizieR:"+c,color:a}));catalog.updateShape({color:a})},updateShapeOfCatalog:function(a,b){var c=document.getElementById(b).parentNode.parentNode.id;("XMM"==c?LibraryCatalog.getCatalog("Swarm").al_refs:"Simbad"==
c||"NED"==c?LibraryCatalog.getCatalog(c).al_refs:LibraryCatalog.getCatalog("VizieR:"+c).al_refs).updateShape({shape:a})},updateSizeOfCatalog:function(a,b){var c=document.getElementById(b).parentNode.parentNode.parentNode.id;("XMM"==c?LibraryCatalog.getCatalog("Swarm").al_refs:"Simbad"==c||"NED"==c?LibraryCatalog.getCatalog(c).al_refs:LibraryCatalog.getCatalog("VizieR:"+c).al_refs).updateShape({sourceSize:Number(a)})},showColorMap:function(){100<k.height()?(k.animate({height:"0px"},"fast"),k.css("max-height",
"200px"),k.css("border-width","0px")):(k.animate({height:"101px"},"fast"),k.css("max-height","200px"),k.css("border-width","0.2px"),k.html('<div id = "color_map_box" class="alix_colorMapBox" style = "z-index: 20;position: absolute; width: auto; height: 50px; color: black;"><b>Color Map : </b><select class="aladin-cmSelection"></select><button class="aladin-btn aladin-btn-small aladin-reverseCm" type="button">Reverse</button></div>'));for(var a=$(".alix_colorMapBox"),b=a.find(".aladin-cmSelection"),
c=0;c<ColorMap.MAPS_NAMES.length;c++)b.append($("<option />").text(ColorMap.MAPS_NAMES[c]));b.val(e.view.imageSurvey.getColorMap().mapName);a.find(".aladin-cmSelection").change(function(){var a=$(this).find(":selected").val();e.view.imageSurvey.getColorMap().update(a);G()});a.find(".aladin-reverseCm").click(function(){e.view.imageSurvey.getColorMap().reverse();G()})},reselectSource:ca}}();console.log("=============== >  AladinLite_v.js ");
function AladinLite_mvC(a,b){this.modules={};this.aladinView=a;void 0!=b.historic&&(this.modules.historicModel=b.historic.model);void 0!=b.regionEditor&&(this.modules.regionEditorView=b.regionEditor.view);void 0!=b.hipsSelector&&(this.modules.hipsSelectorModel=b.hipsSelector.model)}
AladinLite_mvC.prototype={bookMark:function(a){return void 0!=this.modules.historicModel?this.modules.historicModel.bookMark(a):null},deleteHistory:function(a){return void 0!=this.modules.historicModel?this.modules.historicModel.deleteHistory(a):null},getHistory:function(a){return void 0!=this.modules.historicModel?this.modules.historicModel.getHistory(a):null},editRegion:function(){return void 0!=this.modules.regionEditorView?this.modules.regionEditorView.init():null},closeEditor:function(){if(void 0!=
this.modules.regionEditorView)this.modules.regionEditorView.setBrowseMode();else return null},setInitialValue:function(a){return void 0!=this.modules.regionEditorView?this.modules.regionEditorView.setInitialValue(a):null},cleanPolygon:function(){return void 0!=this.modules.regionEditorView?this.modules.regionEditorView.clean():null},setPoligon:function(a){return void 0!=this.modules.regionEditorView?this.modules.regionEditorView.setPoligon(a):null},restoreViewById:function(a){return void 0!=this.modules.historicModel?
this.modules.historicModel.restoreViewById(a):null},searchHips:function(a,b){return void 0!=this.modules.hipsSelectorModel?this.modules.hipsSelectorModel.searchHips(a,b):null},buildHipsTab:function(a){return void 0!=this.modules.hipsSelectorModel?this.modules.hipsSelectorModel.buildHipsTab(a):null},getSelectedHips:function(a){return void 0!=this.modules.hipsSelectorModel?this.modules.hipsSelectorModel.getSelectedHips(a):null},searchCataloge:function(a,b){return void 0!=this.modules.hipsSelectorModel?
this.modules.hipsSelectorModel.searchCataloge(a,b):null},buildCataTab:function(a){return void 0!=this.modules.hipsSelectorModel?this.modules.hipsSelectorModel.buildCataTab(a):null},getSelectedCatalog:function(a){return void 0!=this.modules.hipsSelectorModel?this.modules.hipsSelectorModel.getSelectedCatalog(a):null},storeCurrentCatalog:function(a){return void 0!=this.modules.hipsSelectorModel?this.modules.hipsSelectorModel.storeCurrentCatalog(a):null},deleteCatalogInTab:function(a){return void 0!=
this.modules.hipsSelectorModel?this.modules.hipsSelectorModel.deleteCatalogInTab(a):null},createCatalogSelect:function(a){return void 0!=this.modules.hipsSelectorModel?this.modules.hipsSelectorModel.createCatalogSelect(a):null},displaySimbadCatalog:function(){return void 0!=this.modules.hipsSelectorModel?this.modules.hipsSelectorModel.displaySimbadCatalog():null},displayNedCatalog:function(a){return void 0!=this.modules.hipsSelectorModel?this.modules.hipsSelectorModel.displayNedCatalog(a):null},restoreCatalog:function(a){return void 0!=
this.modules.hipsSelectorModel?this.modules.hipsSelectorModel.restoreCatalog(a):null},currentCatalogTab:function(a){return void 0!=this.modules.hipsSelectorModel?this.modules.hipsSelectorModel.currentCatalogTab(a):null},displayDataXml:function(a){return void 0!=this.modules.hipsSelectorModel?this.modules.hipsSelectorModel.displayDataXml(a):null},updateCatalogs:function(a,b){return void 0!=this.modules.hipsSelectorModel?this.modules.hipsSelectorModel.updateCatalogs(a,b):null}};console.log("=============== >  AladinLite_c.js ");
function Historique_Mvc(a,b){this.that=this;this.aladinLite_V=b;this.mark_tab=[];this.view=new Historique_mVc(this,a,b);this.contextDivId=a;this.contextDiv=null;this.idCounter=0;this.hips_tab=[];this.position_tab=[]}
Historique_Mvc.prototype={bookMark:function(a){var b=jQuery.extend(!0,{},a);b.comment="";if(0<b.target.length)for(var c=0;c<b.target.length;c++)b.target[c].ct=null;var c=JSON.stringify(b),d="alix:"+new Date;try{localStorage.setItem(d,c)}catch(f){var c=0,h,e=[];e.push("Sorry. There's no more memory to save the new bookmark,you can delete some bookmarks in the list,or do you want to clear all the storage?");for(h in localStorage)d=2*((localStorage[h].length||0)+(h.length||0)),c+=d,e.push(h.substr(0,
50)+" = "+(d/1024).toFixed(2)+" KB");e.push("Total = "+(c/1024).toFixed(2)+" KB");confirm(e.join("\n"))&&confirm("Do you really want to delete all the storage?")&&localStorage.clear()}console.log("@@@@@@@@@Item storaged locally");this.mark_tab.unshift(b);null==this.contextDiv&&(this.contextDiv=$("#"+this.contextDivId));return this.view.drawContext(a)},cleanRepetition:function(a){for(var b=[],c=0;c<a.length;c++){for(var d=!1,f=0;f<b.length;f++)if(b[f]==a[c].survey.ID){d=!0;break}!0!=d&&b.push(a[c].survey.ID)}return b},
getHistory:function(){return this.view.drawContext()},restoreView:function(a){return this.aladinLite_V.restoreView(a)},deleteHistory:function(a){a=localStorage.key(a);localStorage.removeItem(a);return this.view.drawContext()},restoreViewById:function(a){return getAladinLiteView(a)},findIdPosition:function(a){for(var b=0;b<this.mark_tab.length&&this.mark_tab[b].id!=a;b++);return b}};
var deepClone=function(a){var b=judgeType(a),c;if("array"===b)c=[];else if("object"===b)c={};else return a;if("array"===b)for(var b=0,d=a.length;b<d;b++)c.push(deepClone(a[b]));else if("object"===b)for(d in a)"function"==judgeType(a[d])?c[d]=a[d].toString():c[d]=deepClone(a[d]);return c},judgeType=function(a){return a instanceof Element?"element":{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date",
"[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"}[Object.prototype.toString.call(a)]};console.log("=============== >  Historique_m.js ");var Historique_mVc=function(a,b,c){this.that=this;this.model=a;this.contextDivId=b;this.contextDiv=null;this.aladinLite_V=c};
Historique_mVc.prototype={drawContext:function(){var a=!0;null==this.contextDiv&&(this.contextDiv=$("#"+this.contextDivId));var b='<ul id = "history_ul" style="padding-left:18px;">';console.log("@@@@@@@@localStorage.length="+localStorage.length);for(var c in localStorage)console.log("Localstorage key="+c);deleteAllObjs();for(var d=0;d<localStorage.length;d++)if(c=localStorage.key(d),c.startsWith("alix:")){var f=localStorage.getItem(c),f=JSON.parse(f);f.id=d;c=setAladinLiteView(f,c);void 0!=c.survey&&
(console.log("//"+c.survey.obs_title),b+="<li style='list-style-type: none;padding-top:5px;'>"+c.getHTMLTitle()+"</li>",b+="<div id='description_"+d+"' style='display: none;'><span>Position: "+c.ra+", "+c.dec+"</span><br><span>Fov: "+c.fov+"</span><br><span>Survey: "+c.survey.obs_title+"</span><p style='font-size:small;line-height: 1em;font-weight:100;color:#000000;'>"+c.survey.obs_description+"</p>"+this.displayCataDescription(c.catalogTab)+"</div>",a=!1)}!0==a&&(b+="<p style='color:#1f252b;text-align:center'>No bookmark restored</p>");
this.contextDiv.html(b+"</ul>");for(d=0;d<localStorage.length;d++)if(c=getAladinLiteView(d))c.setHandlers(),$("#"+d+"_menu_show_description").click(function(a){$("#description_"+this.id.replace("_menu_show_description","")).slideToggle();a.stopPropagation()})},displayCataDescription:function(a){var b="";if(0<a.length){for(var b=b+"<span>Catalog: <br>",c=0;c<a.length;c++)b+=a[c].catalog+",  ";b+="</span>"}return b}};console.log("=============== >  Historique_v.js ");
function RegionEditor_Mvc(a,b,c,d,f){this.node=[];this.canvas=c[0];this.canvaso=d[0];this.context=this.canvas.getContext("2d");this.contexto=this.canvaso.getContext("2d");this.skyPositions=this.overlay=null;this.aladinView=f;this.points=a}
RegionEditor_Mvc.prototype={DrawNode:function(a){for(var b in a)this.context.beginPath(),this.context.arc(a[b].cx,a[b].cy,a[b].r,0,2*Math.PI,!0),this.context.fillStyle="blue",this.context.fill(),this.context.stroke(),this.context.closePath()},DrawnLine:function(a,b,c,d){if(null!=d){this.context.beginPath();this.context.lineCap="round";for(var f in this.node)this.node[d.N]==f&&this.context.moveTo(this.node[d.N].cx,this.node[d.N].cy),this.context.lineTo(this.node[f].cx,this.node[f].cy)}else this.context.clearRect(0,
0,this.canvas.width,this.canvas.height),this.context.beginPath(),this.context.lineCap="round",this.context.moveTo(this.node[a].cx,this.node[a].cy),this.context.lineTo(b,c);this.context.closePath();this.context.strokeStyle="lime";this.context.stroke()},Redrawn:function(a){this.CanvasUpdate();for(var b in this.node)this.context.beginPath(),this.context.arc(this.node[b].cx,this.node[b].cy,this.node[b].r,0,2*Math.PI,!0),this.context.fillStyle="red",this.context.fill(),this.context.stroke(),this.context.closePath();
this.DrawnLine(0,0,0,a)},CanvasUpdate:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.contexto.clearRect(0,0,this.canvas.width,this.canvas.height);this.contexto.drawImage(this.canvas,0,0)},ArrayToObject:function(a){var b=[],c;for(c in a)b.push({cx:a[c][0],cy:a[c][1],r:5});this.node=[];this.node=b},GetHeight:function(a){var b=null,c=null,d;for(d in a)temp=a[d][0],null==b?b=temp:temp>=b&&(b=temp),null==c?c=temp:temp<=c&&(c=temp);a=b-c;180<a&&(a=360-a);return{ramax:b,
ramin:c,largeur:a}},NumeroSegmen:function(){for(var a,b,c=[],d=0;d<this.node.length;d++)void 0==a?a=d:void 0==b&&(b=d),void 0!=a&&void 0!=b&&(c.push({A:a,B:b}),a=b,b=void 0);c.push({A:this.node.length-1,B:0});return c},GetWidth:function(a){var b=null,c=null,d,f;for(f in a)d=a[f][1],null==b?b=d:d>=b&&(b=d),null==c?c=d:d<=c&&(c=d);a=b-c;180<a&&(a=360-a);return{decmax:b,decmin:c,width:a}},DrawGrafic:function(a){var b=a.width,c=a.height;a.getContext("2d");for(var d=a=20,f=0;f<c;f++)this.contextGrafic.beginPath(),
0===f?(this.contextGrafic.moveTo(f+20,10),this.contextGrafic.lineTo(f+20,c),this.contextGrafic.fillStyle="black",this.contextGrafic.font="bold 8px sans-serif",this.contextGrafic.fillText("0",f+15,20)):(this.contextGrafic.moveTo(f+a,20),this.contextGrafic.lineTo(f+a,c),this.contextGrafic.fillStyle="black",this.contextGrafic.font="bold 8px sans-serif",this.contextGrafic.fillText(f,f+a-3,20)),this.contextGrafic.closePath(),this.contextGrafic.strokeStyle="yellow",this.contextGrafic.stroke(),a=parseInt(a+
20);for(f=0;f<b;f++)this.contextGrafic.beginPath(),this.contextGrafic.lineCap="round",0===f?(this.contextGrafic.moveTo(12,f+20),this.contextGrafic.lineTo(b,f+20)):(this.contextGrafic.moveTo(12,0+d),this.contextGrafic.lineTo(b,0+d),this.contextGrafic.font="bold 8px sans-serif",this.contextGrafic.fillStyle="black",this.contextGrafic.fillText(f,3,0+d+3)),this.contextGrafic.closePath(),this.contextGrafic.strokeStyle="brown",this.contextGrafic.stroke(),d=parseInt(d+20)},isEmpty:function(){return 0==this.node.length?
!0:!1},addNode:function(a,b,c,d){if(d)a={},b={},d=parseInt(c[0].position),a.cx=c[0].cx,a.cy=c[0].cy,a.r=c[0].r,this.node.length===d?(b.cx=this.node[this.node.length-1].cx,b.cy=this.node[this.node.length-1].cy,b.r=5,this.node.splice(this.node.length-1,1,b,a)):(b.cx=this.node[c[0].position].cx,b.cy=this.node[c[0].position].cy,b.r=5,this.node.splice(c[0].position,1,a,b)),this.Redrawn(0);else if("object"!=typeof c)0==c&&1<this.node.length?this.node.unshift({cx:a,cy:b,r:5}):this.node.push({cx:a,cy:b,r:5}),
this.DrawNode(this.node);else if(void 0!=c){d={};var f={};f.cx=c.segmento.xA;f.cy=c.segmento.yA;f.r=5;d.cx=a;d.cy=b;d.r=5;this.node.splice(c.segmento.segmento,1,f,d);this.Redrawn(0)}},getNode:function(a,b){var c=0,d=0,c=0,f;for(f in this.node)if(c=a-this.node[f].cx,d=b-this.node[f].cy,c=c*c+d*d,25>=c)return f;return-1},getSegment:function(a){var b=0,c=0;0==a?(b=parseInt(a)+1,c=this.node.length-1):a==this.node.length-1?(b=parseInt(this.node.length-1-1),c=0):0!=a&&a!=this.node.length-1&&(b=parseInt(a)+
1,c=parseInt(a)-1);return{A:b,B:c,N:a}},canvasUpdate:function(){this.contexto.drawImage(this.canvas,0,0);this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},drawHashline:function(a,b,c){this.DrawnLine(a,b,c)},CleanLine:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},isExtremity:function(a){return 0==a||a==this.node.length-1?!0:!1},closePolygone:function(a,b){if(a!=b){if(0==a&&b==this.node.length-1){for(var c in this.node)this.context.beginPath(),this.context.arc(this.node[c].cx,
this.node[c].cy,this.node[c].r,0,2*Math.PI,!0),this.context.fillStyle="red",this.context.fill(),this.context.stroke(),this.context.closePath();return!0}if(a==this.node.length-1&&0==b){for(c in this.node)this.context.beginPath(),this.context.arc(this.node[c].cx,this.node[c].cy,this.node[c].r,0,2*Math.PI,!0),this.context.fillStyle="red",this.context.fill(),this.context.stroke(),this.context.closePath();return!0}}return!1},Drag:function(a,b,c,d){this.node[a].cx=b;this.node[a].cy=c;this.node[d.N].cx=
b;this.node[d.N].cy=c;this.Redrawn(d)},almacenar:function(){if(null!=this.skyPositions){this.node=[];this.skyPositions.pop();for(var a=0;a<this.skyPositions.length;a++)this.node.push(this.aladinView.world2pix(this.skyPositions[a][0],this.skyPositions[a][1]));this.ArrayToObject(this.node);this.Redrawn(this.node)}},DeleteOverlay:function(){null!=this.overlay&&(this.overlay.addFootprints(A.polygon(this.skyPositions)),this.overlay.removeAll(),this.overlay.overlays=[])},recuperar:function(){if(!(this.node&&
0==this.node.length&&this.skyPositions&&0<this.skyPositions.length)){this.skyPositions=[];for(var a=0;a<this.node.length;a++)this.skyPositions.push(this.aladinView.pix2world(this.node[a].cx,this.node[a].cy));null==this.overlay&&(this.overlay=A.graphicOverlay({color:"red"}),this.aladinView.addOverlayer(this.overlay));this.overlay.removeAll();this.overlay.addFootprints([A.polygon(this.skyPositions)])}},setPolygon:function(a){this.skyPositions=[];for(var b=0;b<a.length;b++)this.skyPositions.push(a[b]);
null==this.overlay&&(this.overlay=A.graphicOverlay({color:"red"}),this.aladinView.addOverlayer(this.overlay));this.overlay.removeAll();this.overlay.addFootprints([A.polygon(this.skyPositions)])},setOverlay:function(a){null==this.overlay&&(this.overlay=A.graphicOverlay({color:"red"}),this.aladinView.addOverlayer(this.overlay));this.overlay.removeAll()},CleanPoligon:function(){this.CanvasUpdate();this.node=[];this.skyPositions=[]},PolygonCenter:function(){var a=BasicGeometry.getEnclosingView(this.skyPositions);
this.aladin.gotoPosition(a.center.ra,a.center.dec);this.aladin.setZoom(1.2*a.size)},RemoveNode:function(a,b){4<=this.node.length&&(this.node.splice(a,1),b?this.DrawNode(this.node):this.Redrawn(0))},GetXYNode:function(a,b){var c={},d,f,h;for(h in this.node)d=a-this.node[h].cx,f=b-this.node[h].cy,25>=d*d+f*f&&(void 0==c.a?c.a=h:c.b=h);return c},GetNodelength:function(){return this.node},createGrafic:function(a){this.DrawGrafic(a)},cuadradoIndicador:function(a,b){this.context.beginPath();this.context.fillRect(a,
b,10,10);this.context.fillStyle="red";this.context.fill();this.context.stroke();this.context.closePath()},stokeNode:function(a){if(void 0!=a)var b=[];b.push({position:a,cx:this.node[a].cx,cy:this.node[a].cy,r:5});return b},getSkyPositions:function(){return this.skyPositions}};console.log("=============== >  RegionEditor_m.js ");
function RegionEditor_mVc(a,b,c,d,f){this.parentDivId=b;this.points=this.controller=this.lineContext=this.lineCanvas=this.drawContext=this.drawCanvas=null;this.clientHandler=null==d?function(){alert("No client handler registered")}:d;this.contextDivId=c;this.parentDiv=this.sousContextDiv=this.contextDiv=null;this.aladinLite_V=a;this.editionFrame=f}var browseSaved=null;
RegionEditor_mVc.prototype={init:function(){null==this.parentDiv&&(this.parentDiv=$("#"+this.parentDivId));null==this.contextDiv&&(this.contextDiv=$("#"+this.contextDivId));this.contextDiv.append('<div id= "RE_context" style = "display:inline"></div>');var a=this;AladinLiteX_mVc.regionEditorInit||(this.lineCanvas=$("<canvas id='RegionCanvasTemp' class='editor-canvas'></canvas>"),this.lineCanvas[0].width=this.parentDiv.width(),this.lineCanvas[0].height=this.parentDiv.height(),this.lineContext=this.lineCanvas[0].getContext("2d"),
this.parentDiv.append(this.lineCanvas),this.lineCanvas.css("z-index","100"),this.lineCanvas.css("position","absolute"),this.lineCanvas.hide(),this.drawCanvas=$("<canvas id='RegionCanvas' class='editor-canvas' ></canvas>"),this.drawCanvas[0].width=this.parentDiv.width(),this.drawCanvas[0].height=this.parentDiv.height(),this.drawContext=this.drawCanvas[0].getContext("2d"),this.parentDiv.append(this.drawCanvas),this.drawCanvas.css("z-index","101"),this.drawCanvas.css("position","absolute"),this.drawCanvas.hide(),
this.controller=new RegionEditor_mvC({handler:this.clientHandler,canvas:this.drawCanvas,canvaso:this.lineCanvas,aladinView:this.aladinLite_V}),this.drawCanvas[0].addEventListener("mousedown",function(b){a.controller.mouseDown(b)},!1),this.drawCanvas[0].addEventListener("mousemove",function(b){a.controller.mouseMove(b)},!1),this.drawCanvas[0].addEventListener("mouseup",function(b){a.controller.mouseUp(b)},!1));this.contextDiv.append('<p style="color:#1f252b;text-align:center">Region Editor Mode</p>');
this.browseBtn=$("<button id='regionEditor_b' class='alix_browse_btn alix_btn'>Browse&nbsp;<i class='glyphicon glyphicon-check'></i></button>");this.contextDiv.append(this.browseBtn);this.browseBtn.css("margin-top","10px");this.browseBtn.css("margin-left","5px");this.browseBtn.css("font-weight"," bold");this.browseBtn.attr("disabled","disabled");this.browseBtn.click(function(b){a.controller.isPolygonClosed()?a.controller.recuperar():a.controller.CleanPoligon();a.setBrowseMode();browseSaved=!1;b.stopPropagation();
a.aladinLite_V.reabledButton()});this.editBtn=$("<button id='regionEditor_e' class='alix_edt_btn alix_btn'>Edit&nbsp;<i class='glyphicon glyphicon-pencil'></i></button>");this.contextDiv.append(this.editBtn);this.editBtn.css("margin-top","10px");this.editBtn.css("margin-left","5px");this.editBtn.css("font-weight"," bold");this.editBtn.click(function(b){a.setEditMode();a.controller.DeleteOverlay();a.lineContext.clearRect(0,0,a.lineCanvas[0].width,a.lineCanvas[0].height);a.drawContext.clearRect(0,0,
a.drawCanvas[0].width,a.drawCanvas[0].height);a.controller.almacenar();a.aladinLite_V.disabledButton();b.stopPropagation()});this.effacerBtn=$("<button id='regionEditor_c' class=' alix_clear_btn alix_btn'>Clear&nbsp;<i class='glyphicon glyphicon-trash'></i></button>");this.contextDiv.append(this.effacerBtn);this.effacerBtn.css("margin-top","10px");this.effacerBtn.css("margin-left","5px");this.effacerBtn.css("font-weight"," bold");this.effacerBtn.click(function(b){a.controller.CleanPoligon();b.stopPropagation()});
this.setBrowseMode();var b=$("<button id='regionEditor_a' class=' alix_accept_btn alix_btn'>Accept&nbsp;<i class='glyphicon glyphicon-share'></i></button>");this.contextDiv.append(b);b.css("margin-top","10px");b.css("margin-left","5px");b.css("font-weight"," bold");b.click(function(b){a.controller.recuperar();a.setBrowseMode();a.controller.invokeHandler(!0);a.aladinLite_V.reabledButton();document.getElementById("region").disabled=!1;browseSaved=!0;b.stopPropagation()});AladinLiteX_mVc.regionEditorInit||
(this.setInitialValue(this.defaultRegion),this.editionFrame&&(this.setEditionFrame(this.editionFrame),this.setEditMode()),AladinLiteX_mVc.regionEditorInit=!0)},clean:function(){this.controller&&(this.controller.CleanPoligon(),this.setEditMode(),this.controller.DeleteOverlay(),this.lineContext.clearRect(0,0,this.lineCanvas[0].width,this.lineCanvas[0].height),this.drawContext.clearRect(0,0,this.drawCanvas[0].width,this.drawCanvas[0].height),this.controller.almacenar(),this.controller.recuperar(),this.setBrowseMode())},
setEditionFrame:function(a){a&&(this.editionFrame=a);var b=null;this.editionFrame&&("array"==this.editionFrame.type?b=this.parseArrayPolygon(this.editionFrame.value):"soda"==this.editionFrame.type?b=this.parseSodaPolygon(this.editionFrame.value):alert("Polygone format "+a.type+" not understood"),b?(a=BasicGeometry.getEnclosingView(b),this.aladinLite_V.gotoPosition(a.center.ra,a.center.dec),this.aladinLite_V.setZoom(1.2*a.size),null==this.editionFrameOverlay&&(this.editionFrameOverlay=A.graphicOverlay({color:"blue",
name:"Editable Frame"}),this.aladinLite_V.addOverlayer(this.editionFrameOverlay)),this.editionFrameOverlay.removeAll(),this.editionFrameOverlay.addFootprints([A.polygon(b)]),$("#center").val("Ed. Frame").attr("title","Center the view on the editable frame")):(this.editionFrame=null,$("#center").val("Center").attr("title","Center on the current drawing")))},setInitialValue:function(a){console.log(a);if(this.points=a){a=[];if("saadaql"==this.points.type){var b=/"(.*)"/.exec(this.points.value);if(2!=
b.length){Modalinfo.error(this.points.value+" does not look like a SaadaQL statment");return}if(this.points.value.startsWith("isInRegion"))for(var b=b[1].split(/[\s,;]/),c=0;c<b.length;c++)a.push(parseFloat(b[c]));else b=b[1].replace(/:/g," "),this.posField.val(b),this.aladin.setZoom(0.55),this.aladin.gotoObject(b)}else if("array2dim"==this.points.type)a=this.points.value;else{alert("Polygone format "+this.points.type+" not understood");return}this.setBrowseMode();this.controller.DeleteOverlay();
this.controller.setPoligon(a)}},setBrowseMode:function(){this.editBtn.removeAttr("disabled");this.browseBtn.attr("disabled","disabled");this.effacerBtn.attr("disabled","disabled");this.lineCanvas.hide();this.drawCanvas.hide()},setEditMode:function(){this.browseBtn.removeAttr("disabled");this.editBtn.attr("disabled","disabled");this.effacerBtn.removeAttr("disabled");this.lineCanvas.show();this.drawCanvas.show()},parseSodaPolygon:function(a){a=a.split(/\s+/);var b=null;if("POLYGON"!=a[0].toUpperCase())alert("Only SODA POLYGON are supported");
else if(a.shift(),!a||0!=a.length%2||6>a.length)alert("Even number of coordinates required ("+a.length+" values read)");else{for(var b=[],c=0;c<a.length/2;c++)b[b.length]=[parseFloat(a[2*c]),parseFloat(a[2*c+1])];b.push(b[0])}return b},parseArrayPolygon:function(a){var b=null;if(!a||0!=a.length%2||6>a.length)alert("Even number of coordinates required");else{for(var b=[],c=0;c<a.length/2;c++)b[b.length]=[a[2*c],a[2*c+1]];b.push(b[0])}return b}};console.log("=============== >  RegionEditor_v.js ");
function RegionEditor_mvC(a){this.polygonModel=new RegionEditor_Mvc(a.points,a.handler,a.canvas,a.canvaso,a.aladinView);this.canvas=a.canvas;this.clientHandler=a.handler;this.startingNode=-1;this.startdrag=this.movestart=this.closed=this.buttondown=!1;this.drag=null;this.result=-1;this.stokeNode}
RegionEditor_mvC.prototype={getStatus:function(){return"startingNode="+this.startingNode+" buttondown="+this.buttondown+" closed="+this.closed+" movestart="+this.movestart+" startdrag="+this.startdrag+" drag="+this.drag+" result="+this.result+" stokeNode="+this.stokeNode},checkPolygon:function(a){return!0},mouseDown:function(a){var b=-1,c=parseInt(a.pageX)-parseInt(this.canvas.offset().left).toFixed(1);a=parseInt(a.pageY)-parseInt(this.canvas.offset().top).toFixed(1);this.polygonModel.isEmpty()?this.polygonModel.addNode(c,
a):!0==this.closed&&-1!=(b=this.polygonModel.getNode(c,a))?(this.result=this.polygonModel.getSegment(b),this.stokeNode=this.polygonModel.stokeNode(b),this.startdrag=!0,this.startingNode=this.drag=b,this.canvas.css("cursor","move")):-1!=(b=this.polygonModel.getNode(c,a))&&this.polygonModel.isExtremity(b)&&(!0==this.closed?(this.startingNode=-1,this.buttondown=!1):(this.startingNode=b,this.buttondown=!0,this.closed=!1));this.closed&&-1==b&&(b=this.polygonModel.GetNodelength(),b=(new Segment(b)).IsCursorOn(c,
a),void 0!=b&&("vertical"==b.flag?this.polygonModel.addNode(c,a,b):"horizontal"==b.flag?this.polygonModel.addNode(c,a,b):"distancia"==b.flag&&this.polygonModel.addNode(c,a,b)))},mouseMove:function(a){var b=parseInt(a.pageX)-parseInt(this.canvas.offset().left).toFixed(1);a=parseInt(a.pageY)-parseInt(this.canvas.offset().top).toFixed(1);!0==this.buttondown&&-1!=this.startingNode?(this.movestart=!0,this.polygonModel.drawHashline(this.startingNode,b,a,this.result)):this.startdrag&&this.polygonModel.Drag(this.drag,
b,a,this.result)},mouseUp:function(a){var b=-1,c,d=parseInt(a.pageX)-parseInt(this.canvas.offset().left).toFixed(1);a=parseInt(a.pageY)-parseInt(this.canvas.offset().top).toFixed(1);!0==this.buttondown&&-1!=(b=this.polygonModel.getNode(d,a))&&(!1==this.polygonModel.isExtremity(b)&&(this.polygonModel.CleanLine(),this.buttondown=!1),!0==this.polygonModel.closePolygone(b,this.startingNode)&&(this.buttondown=!1,this.closed=!0));!0==this.closed&&null!=(c=this.polygonModel.GetXYNode(d,a))&&void 0!=c.a&&
void 0!=c.b&&(this.startingNode==c.a?this.polygonModel.RemoveNode(c.a,!1):this.startingNode==c.b&&this.polygonModel.RemoveNode(c.b,!1));!0==this.buttondown&&!0==this.movestart?b==this.startingNode&&-1!=this.polygonModel.getNode(d,a)?(this.movestart=this.buttondown=!1,this.polygonModel.CleanLine()):(this.polygonModel.addNode(d,a,this.startingNode),this.movestart=this.buttondown=!1,b=this.polygonModel.GetNodelength(),b=new Segment(b),b=b.Itersection(this.startingNode,!1),-1!=b&&void 0!=b&&(0!=this.startingNode?
this.polygonModel.RemoveNode(b.nB,!0):this.polygonModel.RemoveNode(b.nA,!0),this.polygonModel.CleanLine())):!0==this.buttondown&&!1==this.movestart&&(this.movestart=this.buttondown=!1);!0==this.startdrag&&(this.startdrag=!1,this.canvas.css("cursor","default"),b=this.polygonModel.GetNodelength(),b=new Segment(b),b=b.Itersection(this.startingNode,!0),-1!=b&&void 0!=b&&(this.polygonModel.RemoveNode(this.startingNode,!1),this.polygonModel.addNode(d,a,this.stokeNode,!0)));this.polygonModel.canvasUpdate()},
almacenar:function(){this.polygonModel.almacenar()},recuperar:function(){this.polygonModel.recuperar()},DeleteOverlay:function(){this.polygonModel.DeleteOverlay()},CleanPoligon:function(){this.polygonModel.CleanPoligon();this.closed=!1},PolygonCenter:function(){this.polygonModel.PolygonCenter()},CreateGrafic:function(a){this.polygonModel.createGrafic(this.canvas)},show:function(){alert(this.polygonModel.getSkyPositions())},setPoligon:function(a){this.polygonModel.setPolygon(a);this.closed=!0;this.invokeHandler(!1);
return!0},invokeHandler:function(a){if(this.isPolygonClosed()){var b=BasicGeometry.getEnclosingView(this.polygonModel.skyPositions);this.clientHandler({isReady:!0,userAction:a,region:{format:"array2dim",points:this.polygonModel.skyPositions,size:{x:b.size,y:b.size}}})}else alert("Polygon not closed")},isPolygonClosed:function(){return this.closed||void 0==this.polygonModel.node||0==this.polygonModel.node.length}};console.log("=============== >  RegionEditor_c.js ");
function HipsSelector_Mvc(a,b){this.tapSchemaQuery="SELECT  TOP 100  tap_schema.tables.schema_name as schema, tap_schema.columns.table_name as table,tap_schema.columns.column_name as column ,tap_schema.columns.ucd as ucd FROM tap_schema.columns JOIN tap_schema.tables ON tap_schema.columns.table_name = tap_schema.tables.table_name WHERE tap_schema.columns.table_name = '{$CATID}'";this.baseUrl=this.productType=null;this.imageIdPattern=RegExp(/.*\/C\/.*/);this.imageTilePattern=RegExp(/.*((jpeg)|(png)).*/);
this.view=new HipsSelector_mVc(a,this);this.hips_dict={};this.cata_dict={};this.cata_tab=[];this.cata_created={};this.color={};this.aladinLite_V=b}
HipsSelector_Mvc.prototype={searchHips:function(a,b){var c=this;this.baseUrl="http://alasky.unistra.fr/MocServer/query?RA="+b.ra+"&DEC="+b.dec+"&SR="+b.fov+"&fmt=json&get=record&casesensitive=false";c.view.displaylistepanel();c.productType="image";var d=this.baseUrl;""!=a&&(d+="&publisher_id,creator_did,publisher_did,obs_id,obs_title,obs_regime=*"+a+"*");$.getJSON(d,function(a){if(void 0!=c.productType){for(var b=a.length-1;0<=b;b--)a[b].dataproduct_type!=c.productType&&a.splice(b,1);if("image"==
c.productType)for(b=a.length-1;0<=b;b--){var d=0;if($.isArray(a[b].hips_tile_format))for(var l=0;l<a[b].hips_tile_format.length;l++){if(c.imageTilePattern.test(a[b].hips_tile_format[l])){d=1;break}}else c.imageTilePattern.test(a[b].hips_tile_format)&&(d=1);0==d&&a.splice(b,1)}}c.storeHips(a);c.view.displayHipsList(a)})},storeHips:function(a){for(var b=0;b<a.length;b++)this.hips_dict[a[b].ID]=a[b]},buildHipsTab:function(a){var b=this;this.baseUrl="http://alasky.unistra.fr/MocServer/query?RA="+a.ra+
"&DEC="+a.dec+"&SR="+a.fov+"&fmt=json&get=record&casesensitive=false";b.productType="image";$.getJSON(this.baseUrl,function(a){if(void 0!=b.productType){for(var d=a.length-1;0<=d;d--)a[d].dataproduct_type!=b.productType&&a.splice(d,1);if("image"==b.productType)for(d=a.length-1;0<=d;d--){var f=0;if($.isArray(a[d].hips_tile_format))for(var h=0;h<a[d].hips_tile_format.length;h++){if(b.imageTilePattern.test(a[d].hips_tile_format[h])){f=1;break}}else b.imageTilePattern.test(a[d].hips_tile_format)&&(f=
1);0==f&&a.splice(d,1)}}b.storeHips(a)})},getSelectedHips:function(a){return this.hips_dict[a]},searchCataloge:function(a,b){var c=this;this.baseUrl="http://alasky.unistra.fr/MocServer/query?RA="+b.ra+"&DEC="+b.dec+"&SR="+b.fov+"&fmt=json&get=record&casesensitive=false&MAXREC=100";c.view.displaylistepanel();c.productType="catalog";var d=this.baseUrl;void 0!=a&&""!=a&&(d+="&publisher_id,creator_did,publisher_did,obs_id,obs_title,obs_regime=*"+a+"*");$.getJSON(d,function(a){if(void 0!=c.productType)for(var b=
a.length-1;0<=b;b--)a[b].dataproduct_type!=c.productType&&a.splice(b,1);c.storeCatalog(a);c.view.displayCatalogeList(a)})},buildCataTab:function(a){var b=this;this.baseUrl="http://alasky.unistra.fr/MocServer/query?RA="+a.ra+"&DEC="+a.dec+"&SR="+a.fov+"&fmt=json&get=record&casesensitive=false&MAXREC=200";b.productType="catalog";$.getJSON(this.baseUrl,function(c){if(void 0!=b.productType)for(var d=c.length-1;0<=d;d--)c[d].dataproduct_type!=b.productType&&c.splice(d,1);for(d=0;d<c.length;d++)b.cata_dict[c[d].obs_id]=
c[d];b.restoreCatalog(a)})},storeCatalog:function(a){for(var b=0;b<a.length;b++)this.cata_dict[a[b].obs_id]=a[b];console.log(">>>>>>>>>>>>>>>>>getDataFromUrl"+this.cata_dict)},builTapQuery:function(a){console.log(a);var b=this.tapSchemaQuery.replace("{$CATID}",a);console.log(b);$.ajax({url:"http://tapvizier.u-strasbg.fr/TAPVizieR/tap/sync",data:{lang:"adql",request:"doQuery",format:"json",query:b},method:"GET",async:!1,dataType:"json",success:function(b){for(var d=b.data[0][0]+".'"+a+"'",f=0;f<b.data.length;f++)if(b.data[f][3].startsWith("phot.mag;em")){f=
b.data[f][2];d="SELECT TOP 500 * FROM "+d+" WHERE "+f+" IS NOT NULL AND CONTAINS(POINT('ICRS', RAJ2000, DEJ2000), BOX('ICRS', @ra@, @$dec@, @$fov@, @$fov@)) = 1  ORDER BY "+f+" asc";d="http://tapvizier.u-strasbg.fr/TAPVizieR/tap/sync?lang=adql&request=doQuery&"+encodeURI(d).replace(/@ra@/g,"{$ra}").replace(/@dec@/g,"{$dec}").replace(/@fov@/g,"{$fov}");cata_dict[a].tapProgUrl=d;break}console.log(b)},error:function(a,b,f){WaitingPanel.warn(a.responseText)}})},getSelectedCatalog:function(a){return this.cata_dict[a]},
deleteCatalogInTab:function(a){this.cata_tab.splice(a,1)},createCatalogSelect:function(a){return this.view.createCatalogSelect(a,this.cata_dict)},displaySimbadCatalog:function(){return this.view.displaySimbadCatalog()},displayNedCatalog:function(a){return this.view.displayNedCatalog(a)},currentCatalogTab:function(a){for(var b=[],c=0;c<a.length;c++){var d={catalog:null,color:null,obs_id:null},f=a[c].name;d.catalog=f;d.color=a[c].color;for(var h in LibraryCatalog.catalogs)LibraryCatalog.catalogs[h].nameTemp==
f&&(d.catalog=LibraryCatalog.catalogs[h].name,d.color=LibraryCatalog.catalogs[h].color);d.catalog.startsWith("VizieR")&&(d.obs_id=d.catalog.split(":")[1]);b.push(d)}return b},restoreCatalog:function(a){for(var b=0;b<a.catalogTab.length;b++)this.view.libraryMap.setCatalogByColor(a.catalogTab[b]),"Simbad"==a.catalogTab[b].catalog?this.displaySimbadCatalog():"NED"==a.catalogTab[b].catalog&&this.displayNedCatalog(a),this.cata_dict[a.catalogTab[b].obs_id]&&a.catalogTab[b].obs_id&&(void 0==this.cata_dict[a.catalogTab[b].obs_id].hips_service_url?
this.aladinLite_V.displayVizierCatalog(a.catalogTab[b].obs_id,a.catalogTab[b].color,"showTable"):this.aladinLite_V.displayVizierCatalog(a.catalogTab[b].obs_id,a.catalogTab[b].color,"showTable",this.cata_dict[a.catalogTab[b].obs_id].hips_service_url));this.view.redrawCatalogSelector(a,this.cata_dict)},displayDataXml:function(a){if(void 0!=a.masterResource&&a.masterResource.setParamsInUrl)var b=a.masterResource.setParamsInUrl(a);return this.view.displayDataXml(a,b)},updateCatalogs:function(a,b){if(void 0!=
a.masterResource&&a.masterResource.setParamsInUrl)var c=a.masterResource.setParamsInUrl(a);return this.view.updateCatalogs(a,c,b)}};console.log("=============== >  HipsSelector_m.js ");function HipsSelector_mVc(a,b){this.parentDivId=a;this.parentDiv=null;this.libraryMap=new LibraryMap;this.model=b}
HipsSelector_mVc.prototype={displaylistepanel:function(){null==this.parentDiv&&(this.parentDiv=$("#"+this.parentDivId));this.parentDiv.append('<div id="itemList" class="alix_hips_panel"></div>')},displayHipsList:function(a){var b=$("#itemList");"none"==b.css("display")&&(b.css("display","block"),b.css("z-index","10000"));b.html("<span class=strong style='color:#2e3436;style='font-size: 15px;'>"+a.length+' matching Hips images</span>\n<a href="#" onclick="$(&quot;#itemList&quot;).css(&quot;display&quot;, &quot;none&quot;);"style="top: 18px;float: right;" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="glyphicon glyphicon-remove"></span></a><br><br>');
for(var c=0;c<a.length;c++)b.append("<div id = 'panel_"+a[c].ID+"' class='alix_liste_item' ><bn class='alix_title_in_liste'>"+a[c].obs_title+" | "+a[c].ID+"</bn></div><div id='"+a[c].ID+"' class='alix_description_panel'><span class=alix_datahelp style='cursor: pointer;color:#4D36DC;font-size: medium;' onclick='AladinLiteX_mVc.hipsFunction(&quot;"+a[c].ID+"&quot;)'>"+a[c].obs_title+"</span><br><br><span style='font-size:small;color : #727371'>"+a[c].ID+"</span><br><span class=blackhelp style='font-size:small;'>"+
a[c].obs_regime+"</span><br><span class=blackhelp style='font-size:small;'>"+a[c].obs_description+"</span></div>"),$(document.getElementById("panel_"+a[c].ID)).click(function(){var a=$(this).attr("id").replace("panel_","").replace(/\//g,"\\/");$("#"+a).slideToggle();$(this).toggleClass("alix_liste_item_close")})},displayCatalogeList:function(a){var b=$("#itemList");"none"==b.css("display")&&(b.css("display","block"),b.css("z-index","10000"));b.html("<span class=strong style='font-size: 15px;'>"+a.length+
' matching Catalogues <b>*catalogue progressive</b></span>\n<a href="#" onclick="$(&quot;#itemList&quot;).css(&quot;display&quot;, &quot;none&quot;);" style="top: 18px;float: right;" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="glyphicon glyphicon-remove"></span></a><br><br>');for(var c=0;c<a.length;c++)void 0==a[c].hips_service_url?b.append("<div id = 'catalog_"+a[c].ID+"' class='alix_liste_item' ><span class='alix_title_in_liste' >"+a[c].obs_title+"</span></div><div id='cata_"+
a[c].ID+"' class='alix_description_panel'><span class=alix_datahelp style='cursor: pointer;color:#4D36DC;font-size: medium;' onclick='AladinLiteX_mVc.catalogFunction(&quot;"+a[c].obs_id+"&quot);'>"+a[c].obs_title+"</span><i id='btn_detail_catalog_"+a[c].obs_id+"' title='detail' class='glyphicon glyphicon-info-sign alix_btn-operate-catalog' style='cursor: pointer;' onclick='AladinLiteX_mVc.displayCatalogDetailInContext(&quot;"+a[c].obs_id+"&quot;)'></i>&nbsp;<br><span style='font-size:small;color : #727371'>"+
a[c].obs_id+"</span><br><span class=blackhelp style='font-size:small;'>"+a[c].obs_description+"</span></div>"):b.append("<div id = 'catalog_"+a[c].ID+"' class='alix_liste_item' ><span class='alix_title_in_liste' style='font-weight: bold;'>"+a[c].obs_title+"</span><i class='glyphicon glyphicon-asterisk' style='font-size:8px;'></i></div><div id='cata_"+a[c].ID+"' class='alix_description_panel'><span class=alix_datahelp style='cursor: pointer;color:#4D36DC;font-size: medium;' onclick='AladinLiteX_mVc.catalogFunction(&quot;"+
a[c].obs_id+"&quot);'>"+a[c].obs_title+"</span><i id='btn_detail_catalog_"+a[c].obs_id+"' title='detail' class='glyphicon glyphicon-info-sign alix_btn-operate-catalog' style='cursor: pointer;' onclick='AladinLiteX_mVc.displayCatalogDetailInContext(&quot;"+a[c].obs_id+"&quot;)'></i>&nbsp;<br><span style='font-size:small;color : #727371'>"+a[c].obs_id+"</span><br><span class=blackhelp style='font-size:small;'>"+a[c].obs_description+"</span><br><span style='font-size:small;'>"+a[c].hips_service_url+
"</span></div>"),$(document.getElementById("catalog_"+a[c].ID)).click(function(){var a=$(this).attr("id").replace("catalog_","cata_").replace(/\//g,"\\/").replace(/\+/g,"\\+");$("#"+a).slideToggle();$(this).toggleClass("alix_liste_item_close")})},createCatalogSelect:function(a,b){var c=this;$("#itemList").css("display","none");var d="VizieR:"+a,f=b[a],h;h=LibraryCatalog.getCatalog(d)?LibraryCatalog.getCatalog(d).color:this.libraryMap.getNextFreeColor(a).color;WaitingPanel.show(a);void 0!=f.hips_service_url?
c.model.aladinLite_V.displayVizierCatalog(a,h,"showTable",f.hips_service_url):c.model.aladinLite_V.displayVizierCatalog(a,h,"showTable");var e=LibraryCatalog.getCatalog(d).id;console.log(">>>>>>>>>id:"+e);$("#vizier_list").append('<li id="cata_list_'+e+'" class = "'+a+'"style="list-style-type: none;height:auto;"><div id="cata_operate_'+e+'" title="Show/hide Vizier sources" class="alix_vizier_chosen alix_menu_item" style="display:inline; cursor: pointer;color:'+h+';" >'+b[a].obs_id+'</div>&nbsp;<i id="btn_detail_catalog_'+
e+'" title="detail" class="glyphicon glyphicon-info-sign alix_btn-operate-catalog" style="color:'+h+';cursor: pointer;" onclick="AladinLiteX_mVc.detailCatalogOperator('+e+')"></i>&nbsp;<i id="btn_flash_catalog_'+e+'" title="flash" class="glyphicon glyphicon-flash alix_btn-operate-catalog" style="color:'+h+';cursor: pointer;"></i>&nbsp;<i id="btn_configure_catalog_'+e+'" title="configure" class="glyphicon glyphicon-cog alix_btn-operate-catalog" style="color:'+h+';cursor: pointer;" onclick="AladinLiteX_mVc.configureCatalog('+
e+')"></i><i id="btn_delete_catalog_'+e+'" title="delete" class="glyphicon glyphicon-trash alix_btn-operate-catalog" style="color:'+h+';cursor: pointer;"></i></li>');$("#cata_operate_"+e).unbind("click").click(function(a){a.stopPropagation();a=$(this).text();var d="VizieR:"+a,e=LibraryCatalog.getCatalog(d).color,f=b[a];"alix_vizier_chosen alix_menu_item"!=$(this).attr("class")?($(this).attr("class","alix_vizier_chosen alix_menu_item"),$(this).css("color",e),WaitingPanel.show(a),$("#itemList").css("display",
"none"),void 0!=f.hips_service_url?c.model.aladinLite_V.displayVizierCatalog(a,e,"showTable",f.hips_service_url):c.model.aladinLite_V.displayVizierCatalog(a,e,"showTable")):($(this).attr("class","alix_vizier_in_menu alix_menu_item"),$(this).css("color","#888a85"),c.model.aladinLite_V.cleanCatalog(d))});$("#vizier").on("click","#btn_delete_catalog_"+e,function(a){a.stopPropagation();console.log("!!!!!!!!!!deleteonetime"+this.parentNode.className);a=this.parentNode.className;var b="VizieR:"+a;console.log("delete"+
a);c.model.aladinLite_V.cleanCatalog(b);c.libraryMap.freeColor(a);LibraryCatalog.delCatalog(b);this.parentNode.remove();AladinLiteX_mVc.closeContext();return!1});$("#vizier").on("click","#btn_flash_catalog_"+e,function(a){a.stopPropagation();a="VizieR:"+$("#cata_operate_"+e).text();LibraryCatalog.getCatalog(a).al_refs.makeFlash()})},displaySimbadCatalog:function(){var a=$("#Simbad"),b=this.libraryMap.colorMap.Simbad.color;LibraryCatalog.getCatalog("Simbad")&&(b=LibraryCatalog.getCatalog("Simbad").color,
console.log("Simbadshowcolor"+b));"alix_simbad_in_menu alix_menu_item alix_datahelp"==a.attr("class")?(WaitingPanel.show("Simbad"),a.attr("class","alix_simbad_in_menu alix_menu_item alix_datahelp_selected"),a.css("color",b),$("#btn-Simbad-configure").css("color",b),$("#btn-Simbad-flash").css("color",b),this.model.aladinLite_V.displayCatalog("Simbad",b,"showTable","http://axel.u-strasbg.fr/HiPSCatService/Simbad")):(a.attr("class","alix_simbad_in_menu alix_menu_item alix_datahelp"),a.css("color","#888a85"),
$("#btn-Simbad-configure").css("color","#888a85"),$("#btn-Simbad-flash").css("color","#888a85"),this.model.aladinLite_V.cleanCatalog("Simbad"),LibraryCatalog.getCatalog("Simbad")&&LibraryCatalog.delCatalog("Simbad"),AladinLiteX_mVc.closeContext())},displayNedCatalog:function(a){var b=$("#NED"),c=this.libraryMap.colorMap.NED.color;LibraryCatalog.getCatalog("NED")&&(c=LibraryCatalog.getCatalog("NED").color);"alix_ned_in_menu alix_menu_item alix_datahelp"==b.attr("class")?1<=a.fov?WaitingPanel.warnFov():
(WaitingPanel.show("NED"),b.attr("class","alix_ned_in_menu alix_menu_item alix_datahelp_selected"),b.css("color",c),$("#btn-NED-configure").css("color",c),$("#btn-NED-flash").css("color",c),this.model.aladinLite_V.displayCatalog("NED",c,"showTable")):(b.attr("class","alix_ned_in_menu alix_menu_item alix_datahelp"),b.css("color","#888a85"),$("#btn-NED-configure").css("color","#888a85"),$("#btn-NED-flash").css("color","#888a85"),this.model.aladinLite_V.cleanCatalog("NED"),LibraryCatalog.getCatalog("NED")&&
LibraryCatalog.delCatalog("NED"),AladinLiteX_mVc.closeContext())},redrawCatalogSelector:function(a,b){console.log("redrawCatalogSelector!!!!!!!!!");var c=this;$("#vizier_list").html("");for(var d=0;d<a.catalogTab.length;d++){var f=a.catalogTab[d].catalog,h=a.catalogTab[d].obs_id;if(void 0!=h){if(LibraryCatalog.getCatalog(f))var e=LibraryCatalog.getCatalog(f).color,l=LibraryCatalog.getCatalog(f).id;else e=a.catalogTab[d].color;$("#vizier_list").append('<li style="list-style-type: none;height:24px;" class="'+
h+'"><div id="cata_operate_'+l+'" title="Show/hide Vizier sources" class="alix_vizier_chosen alix_menu_item" style="display:inline; cursor: pointer;color:'+e+';" >'+h+'</div>&nbsp;<i id="btn_detail_catalog_'+l+'" title="detail" class="glyphicon glyphicon-info-sign alix_btn-operate-catalog" style="color:'+e+';cursor: pointer;" onclick="AladinLiteX_mVc.detailCatalogOperator('+l+')"></i>&nbsp;<i id="btn_configure_catalog_'+l+'" title="configure" class="glyphicon glyphicon-cog alix_btn-operate-catalog" style="color:'+
e+';cursor: pointer;" onclick="AladinLiteX_mVc.configureCatalog('+l+')"></i><i id="btn_flash_catalog_'+l+'" title="flash" class="glyphicon glyphicon-flash alix_btn-operate-catalog" style="color:'+e+';cursor: pointer;"></i>&nbsp;<i id="btn_delete_catalog_'+l+'" title="delete" class="glyphicon glyphicon-trash alix_btn-operate-catalog" style="color:'+e+';cursor: pointer;"></i></li>');$("#cata_operate_"+l).unbind("click").click(function(a){a.stopPropagation();a=$(this).text();var d="VizieR:"+a,e=LibraryCatalog.getCatalog(d).color,
f=b[a];"alix_vizier_chosen alix_menu_item"!=$(this).attr("class")?($(this).attr("class","alix_vizier_chosen alix_menu_item"),$(this).css("color",e),WaitingPanel.show(a),$("#itemList").css("display","none"),cataInit=void 0!=f.hips_service_url?c.model.aladinLite_V.displayVizierCatalog(a,e,"showTable",f.hips_service_url):c.model.aladinLite_V.displayVizierCatalog(a,e,"showTable")):($(this).attr("class","alix_vizier_in_menu alix_menu_item"),$(this).css("color","#888a85"),c.model.aladinLite_V.cleanCatalog(d))});
$("#vizier").on("click","#btn_delete_catalog_"+l,function(a){a.stopPropagation();console.log("!!!!!!!!!!deleteonetime"+this.parentNode.className);a=this.parentNode.className;var b="VizieR:"+a;console.log("delete"+a);c.model.aladinLite_V.cleanCatalog(b);c.libraryMap.freeColor(a);LibraryCatalog.delCatalog(b);this.parentNode.remove();AladinLiteX_mVc.closeContext();return!1});$("#vizier").on("click","#btn_flash_catalog_"+l,function(a){a.stopPropagation();LibraryCatalog.getCatalog("VizieR:"+this.parentNode.className).al_refs.makeFlash()})}}},
displayDataXml:function(a,b){var c=$("#XMM"),d="#ff0000";LibraryCatalog.getCatalog("Swarm")&&(d=LibraryCatalog.getCatalog("Swarm").color);"alix_XMM_in_menu alix_menu_item alix_datahelp"==c.attr("class")?(WaitingPanel.show("Swarm"),c.attr("class","alix_XMM_in_menu alix_menu_item alix_datahelp_selected"),console.log("displaydataxml"),c.css("color",d),$("#btn-XMM-description").css("color",d),$("#btn-XMM-flash").css("color",d),$("#btn-XMM-configure").css("color",d),$("#ACDS").css("display","inline"),
this.model.aladinLite_V.displayCatalog("Swarm","#ff0000","handler",b)):(c.attr("class","alix_XMM_in_menu alix_menu_item alix_datahelp"),c.css("color","#888a85"),$("#btn-XMM-flash").css("color","#888a85"),$("#btn-XMM-description").css("color","#888a85"),$("#btn-XMM-configure").css("color","#888a85"),$("#ACDS").css("display","none"),this.model.aladinLite_V.cleanCatalog("Swarm"),this.model.aladinLite_V.cleanCatalog("Target"),LibraryCatalog.getCatalog("Swarm")&&LibraryCatalog.delCatalog("Swarm"));AladinLiteX_mVc.closeContext()},
updateCatalogs:function(a,b,c){"alix_XMM_in_menu alix_menu_item alix_datahelp_selected"==$(document.getElementById("XMM")).attr("class")&&(this.model.aladinLite_V.storeCurrentState(),"zoom"==c?1<=a.fov&&!1==a.masterResource.filtered?WaitingPanel.warnFov():(this.model.aladinLite_V.cleanCatalog("Swarm"),WaitingPanel.show("Swarm"),this.model.aladinLite_V.displayCatalog("Swarm","red","handler",b)):"position"==c&&(1<=a.fov&&!1==a.masterResource.filtered&&WaitingPanel.warnFov(),this.model.aladinLite_V.cleanCatalog("Swarm"),
WaitingPanel.show("Swarm"),this.model.aladinLite_V.displayCatalog("Swarm","red","handler",b)));if("alix_ned_in_menu alix_menu_item alix_datahelp_selected"==$(document.getElementById("NED")).attr("class")){this.model.aladinLite_V.storeCurrentState();var d="NED",f=this.libraryMap.colorMap[d].color,h="showTable";this.model.aladinLite_V.cleanCatalog(d);1<=a.fov?WaitingPanel.warnFov():(WaitingPanel.show(d),this.model.aladinLite_V.displayCatalog(d,f,h))}"alix_simbad_in_menu alix_menu_item alix_datahelp_selected"==
$(document.getElementById("Simbad")).attr("class")&&(this.model.aladinLite_V.storeCurrentState(),b="http://axel.u-strasbg.fr/HiPSCatService/Simbad",d="Simbad",f=this.libraryMap.colorMap[d].color,h="showTable",this.model.aladinLite_V.cleanCatalog(d),WaitingPanel.show(d),this.model.aladinLite_V.displayCatalog(d,f,h,b));if(null!=LibraryCatalog.catalogs)if(this.model.aladinLite_V.storeCurrentState(),"zoom"==c)for(d in LibraryCatalog.catalogs)d.startsWith("VizieR:")&&(a=LibraryCatalog.catalogs[d],b=a.id,
c=a.obs_id,"alix_vizier_chosen alix_menu_item"==$(document.getElementById("cata_operate_"+b)).attr("class")&&(void 0!=a.url?(console.log("Progressive Vizier:"+d+"<<<url>>>"+a.url),this.model.aladinLite_V.cleanCatalog(d),this.model.aladinLite_V.displayVizierCatalog(c,a.color,"showTable",a.url)):(console.log("Unprogressive Vizier:"+d+"<<<no url>>>"),this.model.aladinLite_V.cleanCatalog(d),this.model.aladinLite_V.displayVizierCatalog(c,a.color,"showTable"))));else if("position"==c)for(d in LibraryCatalog.catalogs)d.startsWith("VizieR:")&&
(a=LibraryCatalog.catalogs[d],b=a.id,c=a.obs_id,"alix_vizier_chosen alix_menu_item"==$(document.getElementById("cata_operate_"+b)).attr("class")&&(void 0==a.url?(this.model.aladinLite_V.cleanCatalog(d),this.model.aladinLite_V.displayVizierCatalog(c,a.color,"showTable")):(this.model.aladinLite_V.cleanCatalog(d),this.model.aladinLite_V.displayVizierCatalog(c,a.color,"showTable",a.url))))}};console.log("=============== >  HipsSelector_v.js ");
var SwarmDynamicFilter=function(){var a=[],b,c,d=function(d){b=LibraryCatalog.getCatalog("Swarm");c=b.al_refs.getSources();if(0==a.length)f(),console.log("@@@@@@@@No constraint for 3XMM Sources");else for(var e in a)f(a[e])},f=function(b){if(void 0!=b){var d=b.value,f=b.element,m=b.comparator,v=b.type,w=[];a[f]=b}for(var I=0;I<c.length;I++)source=c[I],console.log(source.data[f]),"num"==v?">"==m?parseFloat(source.data[f])>parseFloat(d)?(console.log("show"),source.show(),w.push(source)):(console.log("hide"),
source.hide()):"="==m?parseFloat(source.data[f])>=parseFloat(d)&&parseFloat(source.data[f])<parseFloat(d)+1?(console.log("show"),source.show(),w.push(source)):(console.log("hide"),source.hide()):"<"==m&&(parseFloat(source.data[f])<parseFloat(d)?(console.log("show"),source.show(),w.push(source)):(console.log("hide"),source.hide())):"boolean"==v?source.data[f]==d?(console.log("show"),source.show(),w.push(source)):(console.log("hide"),source.hide()):"String"==v?"LIKE"==m?source.data[f].startsWith(d)?
(console.log("show"),source.show(),w.push(source)):(console.log("hide"),source.hide()):"NOT LIKE"==m?source.data[f].startsWith(d)?(console.log("hide"),source.hide()):(console.log("show"),source.show(),w.push(source)):"IS NULL"==m?null==source.data[f]?(console.log("show"),source.show(),w.push(source)):(console.log("hide"),source.hide()):"IS NOT NULL"==m&&(null==source.data[f]?(console.log("hide"),source.hide()):(console.log("show"),source.show(),w.push(source))):void 0==b&&source.show();c=w};return{runConstraint:d,
addConstraint:function(b){a[b.element]||a.length++;a[b.element]=b;d()},delConstraint:function(b){null!=a&&a[b]&&(delete a[b],a.length--);d()},displayCatalogFiltered:f}}();console.log("=============== >  SwarmDynamicFilter.js ");
var localConf={parentDivId:"aladin-lite-div",defaultView:{defaultSurvey:"DSS colored",field:{position:"M33",defaultFov:"0.5"},panelState:!0},controllers:{historic:{},regionEditor:{},hipsSelector:{}}},externalConf,mixConf=function(a,b){for(var c in b)"object"==typeof b[c]&&a[c]&&(b[c]=mixConf(a[c],b[c]));return Object.assign(a,b)},configureALIX=function(a){a&&(externalConf=a,localConf=mixConf(localConf,a));AladinLiteX_mVc.init(localConf)};console.log("=============== >  ConfigureALiX.js ");
cds.Catalog.prototype._doMakeFlash=function(a,b,c,d){c?this.show():this.hide();var f=this;a<b&&setTimeout(function(){f._doMakeFlash(a+1,b,!c,d)},d)};cds.Catalog.prototype.makeFlash=function(){this._doMakeFlash(1,10,!1,200)};
cds.Source.prototype.actionClicked=function(){if(this.catalog&&this.catalog.onClick){var a=this.catalog.view;if("showTable"==this.catalog.onClick)a.aladin.measurementTable.showMeasurement(this),this.select();else if("showPopup"==this.catalog.onClick){a.popup.setTitle("<br><br>");var b;b='<div class="aladin-marker-measurement"><table>';for(var c in this.data)b+="<tr><td>"+c+"</td><td>"+this.data[c]+"</td></tr>";b+="</table></div>";a.popup.setText(b);a.popup.setSource(this);a.popup.show()}else"function"===
typeof this.catalog.onClick&&(this.catalog.onClick(this),a.lastClickedObject=this,this.select())}};MeasurementTable.prototype.hide=function(){this.divEl.hide();AladinLiteX_mVc.deleteSourceAuto()};cds.Source.prototype.actionOtherObjectClicked=function(){this.catalog&&this.catalog.onClick&&(this.deselect(),AladinLiteX_mVc.cleanCatalog("Target"))};ProgressiveCat.prototype._doMakeFlash=function(a,b,c,d){c?this.show():this.hide();var f=this;a<b&&setTimeout(function(){f._doMakeFlash(a+1,b,!c,d)},d)};
ProgressiveCat.prototype.makeFlash=function(){this._doMakeFlash(1,10,!1,200)};URLBuilder.buildVizieRCSURL=function(a,b,c){b&&"object"===typeof b&&"ra"in b&&"dec"in b&&(b=(new Coo(b.ra,b.dec,7)).format("s"));return"http://vizier.unistra.fr/viz-bin/votable?-source="+a+"&-c="+encodeURIComponent(b)+"&-out.max=20000&-c.rd="+c};console.log("=============== >  AladinUpdate.js ");
